---
title: Python
date: 2024-03-09
description: äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨ Python
categories: 
    - æŠ€æœ¯ç®€ä»‹
---

è§£é‡Šå‹è¯­è¨€ï¼Œè¿è¡Œæ—¶é€šè¿‡ç‰¹å®šè§£é‡Šå™¨æ¥è§£é‡Šå¹¶è¿è¡Œã€‚ä¸€èˆ¬å®˜æ–¹ä½¿ç”¨çš„è§£é‡Šå™¨æ˜¯ CPythonï¼Œä¹Ÿå°±æ˜¯åº•å±‚ä½¿ç”¨ C å®ç°ï¼Œå¦å¤–å¤§éƒ¨åˆ†ç¬¬ä¸‰æ–¹åº“ï¼ˆåƒ Numpyï¼‰ä¹Ÿéƒ½æ˜¯ä»¥ CPython è°ƒç”¨ä¸ºç›®çš„æ¥å®ç°çš„ã€‚  

åœ¨ `import` åº“æ—¶ä¼šç”Ÿæˆå¸¦è§£é‡Šå™¨ä¿¡æ¯åç¼€çš„å­—èŠ‚ç ï¼ˆå¸¸ä¸º `__pycache__/*.cpython-36.pyc`ï¼‰ä»¥é¿å…å¤ªå¤šé‡å¤ç¼–è¯‘ï¼Œå¯ä»¥é€šè¿‡ `export PYTHONDONTWRITEBYTECODE=1` æ¥é¿å…ç”Ÿæˆå­—èŠ‚ç ï¼Œ`find . -type f -name "*.py[co]" -delete -or -type d -name "__pycache__" -delete` æ¥åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚  

![running](running.webp)

æ³¨æ„ï¼ŒCython å’Œ CPython ä¸åŒï¼ŒCython æ˜¯ä¸€ç§ C/C++ å’Œ Python äº’å–æ‰€é•¿æ··åˆä½¿ç”¨çš„è¯­è¨€ï¼Œæœ€ç»ˆè¾“å‡º C ä»£ç ã€‚

## å®‰è£…
æ¨èä½¿ç”¨ `pyenv` ç­‰å·¥å…·å®‰è£…ç®¡ç†ï¼Œä½¿ç”¨ ppa æºå®‰è£…å¯èƒ½ä¼šå‡ºç°é—®é¢˜


## æœ€ä½³å®è·µ
https://pythonguidecn.readthedocs.io/zh/latest/

### åº“å®‰è£…å’Œæ‰“åŒ…
é¡¹ç›®ä¸­å­˜åœ¨ `setup.py` æ˜¯ Python åŒ…æ„å»ºåˆ†å‘å·¥å…·æ‰€ä½¿ç”¨çš„æ–‡ä»¶ï¼Œå¦‚æœéœ€è¦ä»æºç å®‰è£… Python åŒ…ä¸€èˆ¬ä¼šä½¿ç”¨é‡‡ç”¨è¿™æ ·çš„æ–¹å¼

```sh
python setup.py build
python setup.py install
```

ä½†ç”±äº `setuptools` åœ¨ä¾èµ–ä¸Šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œç°åœ¨å·²é€æ­¥å¼ƒç”¨ã€‚å»ºè®®é‡‡ç”¨ `pyproject.toml` æ¥æ›¿ä»£ `setup.py` æ¥æ„å»ºå·¥ç¨‹ï¼Œå…·ä½“å¯å‚ç…§ https://godatadriven.com/blog/a-practical-guide-to-setuptools-and-pyproject-toml/

æ›´å¸¸è§çš„å®‰è£…åº“æ–¹æ³•æ˜¯ç›´æ¥ä½¿ç”¨ pip å®‰è£…

```sh
pip install xxx
pip install -e .    # ä¸å®‰è£… wheelï¼Œè€Œæ˜¯å¼•ç”¨æºä»£ç ç›®å½•ï¼Œç”¨äºå¼€å‘æ—¶å³æ—¶ä½¿ç”¨ä¿®æ”¹çš„ä»£ç 
pip install -e .[full]   # å®‰è£… extras_require ç‰ˆæœ¬
```

ä¸€èˆ¬å®‰è£…çš„è·¯å¾„æ˜¯ `/usr/local/lib/pythonx.x/dist-packages`ï¼Œä½†ä¸€äº›è‡ªå·±ç¼–è¯‘çš„ python åº“å¯èƒ½ä¼šå®‰è£…åˆ° `/usr/lib/pythonx.x/site-packages` ä¸‹ï¼Œåªæ˜¯ä¸ºäº†åŒºåˆ†åº“çš„æ¥æºè€Œå·²ï¼Œåœ¨æ™®éä½¿ç”¨è™šæ‹Ÿç¯å¢ƒçš„ç°åœ¨ä¼¼ä¹æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå¯ä»¥æ‰‹åŠ¨ç§»åŠ¨åº“ç»Ÿä¸€æ”¾åˆ° `dist-packages` é‡Œ

æ€»çš„æ¥è¯´ï¼Œæ ¹ç›®å½•çš„å·¥ç¨‹æ–‡ä»¶æœ‰å¦‚ä¸‹è¿™äº›ï¼š
- `setup.py`ï¼šä½¿ç”¨ `setuptools` åˆ†å‘æ‰“åŒ…åº“çš„è„šæœ¬ï¼Œä¼ ç»Ÿæ–¹æ³•ï¼Œè¾ƒä¸ºå›ºå®šï¼Œç°é€æ­¥å¼ƒç”¨
- `setup.cfg`ï¼šä¸ºäº†é¿å… `setup.py` çš„é‡å¤æ ·æœ¬ä»£ç è€Œä½¿ç”¨çš„ ini æ–‡ä»¶ https://setuptools.pypa.io/en/latest/userguide/declarative_config.html#declarative-config
- `pyproject.toml`ï¼šPEP 517 æå‡ºçš„æ–°çš„æ‰“åŒ…åˆ†å‘ Python æ¨¡å—çš„ ini æ–‡ä»¶ï¼Œå¯ä»¥æŒ‡å®šä½¿ç”¨ä»€ä¹ˆå·¥å…·æ¥è¿›è¡Œç”Ÿæˆåˆ†å‘

å…³äº pip å®‰è£…ç¼“å­˜å¯ä»¥è§ [[Ubuntuç³»ç»Ÿé—®é¢˜#pip ç¼“å­˜é—®é¢˜|pip ç¼“å­˜é—®é¢˜]]

å…³äºå¯¼å‡ºä½¿ç”¨çš„ pip åº“ï¼Œåœ¨å®¹å™¨ä¸­å¯ä»¥ç›´æ¥ç”¨ `pip freeze > requirements.txt` å¯¼å‡ºå½“å‰ç¯å¢ƒæ‰€æœ‰ python åº“

å…³äºæ›´å¤šå‚è§ï¼š
1. https://ianhopkinson.org.uk/2022/02/understanding-setup-py-setup-cfg-and-pyproject-toml-in-python/
2. https://setuptools.pypa.io/en/latest/build_meta.html


### Linter
ä»£ç æ£€æŸ¥å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ Ruffï¼Œé›†æˆäº†å¾ˆå¤šå¸¸è§çš„åŠŸèƒ½ï¼Œåœ¨ VSCode ä¸Šå¯ä»¥ä½¿ç”¨ auto-fix ä»¥åŠ Organize import æ¥æ•´ç†ä»£ç 

```python
# åœ¨è¡Œåé¢åŠ ä¸Š # noqa è¡¨ç¤ºè®© linter å¿½ç•¥è¿™ä¸€è¡Œçš„è­¦å‘Š
xxxxxxx = xxxxx    # noqa
```

### Formatter
è‡ªåŠ¨æ ¼å¼åŒ–å·¥å…·ï¼Œä½¿ç”¨ Black å¯ä»¥ä¸éœ€è¦é…ç½®

### å•å…ƒæµ‹è¯•
æµ‹è¯•çš„å•å…ƒè¦å°½å¯èƒ½å°è€Œä¸”ç‹¬ç«‹ï¼Œå‡½æ•°å‘½åé‡‡ç”¨å°½å¯èƒ½é•¿çš„åŠŸèƒ½æè¿°æ€§åå­—

å¯ä»¥ä½¿ç”¨ [pytest](https://learning-pytest.readthedocs.io/zh/latest/doc/intro/getting-started.html)ï¼ŒåŸºæœ¬æµç¨‹å°±æ˜¯ Arrange-Act-Assertï¼Œéœ€è¦å°†æ–‡ä»¶å‘½åä¸º `test_xxx` æ ¼å¼
```python
from xxx import func

def test_xxxxxx():
    x = 10
    y = func(x)
    assert(y == 10)
```
ç„¶ååœ¨ tests æ–‡ä»¶å¤¹ç›®å½•ç»ˆç«¯è¾“å…¥ pytest å°±ä¼šè¿›è¡Œè‡ªåŠ¨æµ‹è¯•


## ç‰¹æ€§
### REPL
REPLï¼ˆRead-Eval-Print Loopï¼‰æ˜¯ä¸€ç§é¡¶å±‚äº¤äº’çš„ shellï¼Œå¯ä»¥è¾“å…¥è¯­è¨€ç›¸å…³çš„å‘½ä»¤æ‰“å°ç»“æœï¼ŒCLIï¼ˆCommand-line interfaceï¼‰ä¹Ÿæ˜¯è¿™æ ·çš„ä¸œè¥¿ï¼ˆè§ [[Shell]]ï¼‰ã€‚Python ä¹Ÿå¸¦æœ‰ REPL å·¥å…·ï¼Œåœ¨å‘½ä»¤è¡Œç»ˆç«¯ä¸‹è¾“å…¥ `python` å°±ä¼šæ‰“å¼€ç›¸åº”ç‰ˆæœ¬çš„ REPL shellï¼Œç„¶åå°±èƒ½æ‰§è¡Œ Python å‘½ä»¤

### è„šæœ¬
python æ–‡ä»¶ `.py` å¯è§†ä½œè„šæœ¬ç›´æ¥ç”¨å‘½ä»¤è¡Œè§£æå™¨ `python xxx.py` è§£ææ‰§è¡Œï¼Œå…¶æ‰§è¡Œé¡ºåºæ˜¯ç”±ä¸Šè€Œä¸‹é€è¡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å…ˆ `python` è¿›å…¥å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼å†é€æ¡è¾“å…¥å‘½ä»¤æ‰§è¡Œæˆ–ä½œä¸ºæ¨¡å—è°ƒç”¨ï¼ŒåŒºåˆ«åœ¨äºä¸åŒçš„ __å†…ç½®å˜é‡__ï¼ˆå†…ç½®å˜é‡å’Œå†…ç½®æ–¹æ³•æ ¼å¼ä¸º `__xxx__`ï¼Œå¯ä»¥é€šè¿‡ `vars()` æŸ¥çœ‹å†…ç½®å˜é‡ï¼‰ï¼Œå¦‚æœæ‰§è¡Œè„šæœ¬åˆ™ä¼šèµ‹äºˆå†…ç½®å˜é‡ `__name__ = '__main__'`ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æ¥å®ç° main å‡½æ•°ï¼ˆåªåœ¨ä½œä¸ºè„šæœ¬è§£ææ—¶æ‰§è¡Œçš„å‡½æ•°ï¼‰ï¼š
```python
# æ— è®ºæ˜¯è„šæœ¬è§£æè¿˜æ˜¯æ¨¡å—è°ƒç”¨éƒ½é¡ºåºæ‰§è¡Œ
import xxxxxx

# ä¸€èˆ¬æå€¡åœ¨æ­¤å¤„å®šä¹‰å‡½æ•°å’Œç±»è€Œä¸æ˜¯æ‰§è¡Œä»£ç ï¼Œç‰¹åˆ«æ˜¯å¤šè¿›ç¨‹æ—¶éœ€è¦æ³¨æ„è¿™ç‚¹
xxxx

# è‹¥ä¸ºè„šæœ¬è§£æè€Œéæ¨¡å—è°ƒç”¨ï¼Œåˆ™æ‰§è¡Œ
if __name__ == '__main__':
	xxxxx
```

å¦‚æœè¦ä»¥æ¨¡å—æ–¹å¼è¿è¡Œå¯ä»¥ä½¿ç”¨ `python -m xxx.py` ä»¥ import çš„æ–¹å¼æ‰§è¡Œï¼ˆå…è®¸æŸç§ç±»å‹çš„ç›¸å¯¹å¯¼å…¥ï¼Œ`__package__` è®¾ä¸ºå½“å‰æ–‡ä»¶å¤¹ï¼‰

æ­¤å¤–ï¼ŒPython è¿˜æ”¯æŒä»¥ zipapp çš„æ–¹å¼å°† Python ç›®å½•æ‰“åŒ…æˆ zip å‹ç¼©æ–‡ä»¶ä»¥é€šè¿‡ `python xxx.zip` çš„æ–¹å¼æ‰§è¡Œ `xxx/__main__.py`ï¼Œæ–¹ä¾¿è¿›è¡Œç¨‹åºåˆ†å‘

å¯¹äºæœ‰ä¾èµ–åº“çš„å·¥ç¨‹ï¼Œå¯ä»¥ pip å®‰è£… `pipreqs` åº“ï¼Œç„¶åä½¿ç”¨ `pipreqs ./ --encoding=utf-8` æ¥ç”Ÿæˆ `requirements.txt`

### æ¨¡å—
Python æ–‡ä»¶ä¸€èˆ¬åˆ†ä¸ºåŒ…å’Œæ¨¡å—ï¼Œç¼–å†™è„šæœ¬å¹¶ä¸”å¯¼å…¥ç›¸åº”çš„åŒ…æˆ–æ¨¡å—çš„æ–¹æ³•ä»è€Œå®ç°å„ç§åŠŸèƒ½ï¼Œç›¸å½“äºåº“æ–‡ä»¶ï¼ˆè„šæœ¬æœ¬èº«ä¹Ÿå¯è§†ä½œæ¨¡å—ï¼Œåªæ˜¯ä¼šè¿›å…¥ `__main__`ï¼Œå’Œå…¶ä»–è¯­è¨€å·®ä¸å¤šï¼‰ã€‚  

åŒ…å°±æ˜¯æ–‡ä»¶å¤¹æœ¬èº«ï¼Œé€šè¿‡åœ¨æ–‡ä»¶å¤¹å†…éƒ¨æ–°å¢ `__init__.py` è¡¨ç¤ºè¯¥æ–‡ä»¶å¤¹ä¸ºåŒ…ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ ä»£ç æ¥ä½¿å¾— `import xxxpackage` æ—¶è¿›è¡Œä¸€äº›é»˜è®¤è¡Œä¸ºã€‚åœ¨è¿™ä¸ªå±‚é¢ä¸Šï¼Œå¯¼å…¥åŒ…å’Œå¯¼å…¥æ¨¡å—å¯ä»¥ä½¿ç”¨ä¸€æ ·çš„æ–¹æ³•è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚  

æ¨¡å—å°±æ˜¯å®šä¹‰å¯¹è±¡æ–¹æ³•çš„åº“æ–‡ä»¶ï¼Œå¯¼å…¥æ¨¡å—æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼
- ç»å¯¹å¯¼å…¥ï¼š`import xxx` æˆ–è€… `from xxx import xxx`
- ç›¸å¯¹å¯¼å…¥ï¼š`from .xxx import xxx`ï¼Œå¯ä»¥æœ‰å¤šä¸ªå‰å¯¼ç‚¹ï¼Œä½†ä¸æå€¡ã€‚é€šè¿‡æ¨¡å—å±æ€§ `__name__` æˆ–è€… `__package__` ï¼ˆè‹¥æœ‰ï¼‰æ¥å®šä½ä½ç½®
	- Python çš„ç›¸å¯¹å¯¼å…¥åšå¾—ç›¸å¯¹æ¶å¿ƒï¼Œä½ æ— æ³•åœ¨ä½¿ç”¨äº†ç›¸å¯¹å¯¼å…¥çš„æ¨¡å—é‡ŒåŠ å…¥ `if __name__ == '__main__':` æ¥ä¿å­˜æ¨¡å—æµ‹è¯•ä»£ç ï¼Œå› ä¸ºè¿™æ ·ä¼šè¢«è§†ä½œé¡¶å±‚æ–‡ä»¶ï¼ˆ`__name__` è¢«è®¾ç½®ä¸º `__main__`ï¼Œè€Œ `__package__` è¢«è®¾ç½®ä¸º `None`ï¼‰ï¼Œä»è€Œç¼ºå¤±è·¯å¾„æ— æ³•å®Œæˆç›¸å¯¹å¯¼å…¥
	- ä½¿ç”¨ `python -m` è¿è¡Œå¯ä»¥è®© `__package__` è¢«è®¾ç½®ä¸ºå½“å‰æ–‡ä»¶å¤¹ï¼Œè¿è¡Œä¸€å®šç¨‹åº¦çš„ç›¸å¯¹å¯¼å…¥

å¯¹åŒ…çš„å†…éƒ¨ï¼Œæ¨èä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼Œä»¥ä¾¿å¯¹åŒ…è¿›è¡Œç»´æŠ¤ã€‚å¯¹äºè¿è¡Œçš„è„šæœ¬ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç»å¯¹å¯¼å…¥

è¿˜æœ‰åœ¨è„šæœ¬å†…é€šè¿‡å­—ç¬¦ä¸²æ–¹å¼æ¥è¿›è¡Œå¯¼å…¥ï¼š
```python
import importlib
mod = importlib.import_module('xxx_module')
func = getattr(mod, 'xxx_func')  # ä½¿ç”¨å­—ç¬¦ä¸²å¯¼å…¥å‡½æ•°
```

### å¯¹è±¡
Python ä¸€åˆ‡çš†å¯¹è±¡ï¼Œå˜é‡åå’Œå¯¹è±¡ç±»ä¼¼äºæŒ‡é’ˆå’Œå†…å­˜çš„å…³ç³»ï¼ŒåŠ¨æ€åˆ›å»ºå„ç§ç±»å‹çš„å¯¹è±¡å¹¶ç”¨å˜é‡åæŒ‡å‘å®ƒï¼Œä»è€Œè¾¾åˆ° __åŠ¨æ€ç±»å‹__ çš„ç›®çš„ã€‚è¿™æ„å‘³ç€ Python é‡Œå¤§éƒ¨åˆ†èµ‹å€¼è¿ç®—å…¶å®éƒ½æ˜¯æ–°å»ºäº†å¯¹è±¡å†è¿”å›æŒ‡å‘å¯¹è±¡çš„åˆ«å

Python æä¾›å¯å˜ç±»å‹å’Œä¸å¯å˜ç±»å‹
```python
my_list = [1, 2, 3]
my_list[0] = 4   # my_list æœ¬èº« id æ²¡æœ‰æ”¹å˜ï¼Œä½†å…¶çš„å…ƒç´ æ”¹å˜äº†ï¼Œæ˜¯å¯å˜ç±»å‹

x = 6
x = x + 1        # x å˜é‡æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œid å‘ç”Ÿäº†æ”¹å˜ï¼Œæ˜¯ä¸å¯å˜ç±»å‹

x = 'asdx'
x[2] = '2'       # æŠ¥é”™ï¼Œå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸å¯å˜ç±»å‹
```

- å¸¸æ•°ï¼š
  - å‚ä¸æµ®ç‚¹ç›¸å…³æ“ä½œè¦åœ¨æ•°å­—åå°¾åŠ  `.` è¡¨æ˜æ˜¯æµ®ç‚¹å¸¸æ•°ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºé”™
- å…¨å±€å˜é‡ï¼š
  ```python
  a = 10
  
  def asd():
    a = 3
    
  def asd_global():
    global a
    a = 3
    
  # å‡½æ•°å†… a ä¸ºå±€éƒ¨å˜é‡
  asd()          # a = 10
  
  # å‡½æ•°å†… a ä¸ºå…¨å±€å˜é‡
  asd_global()   # a = 3
  ```
- ç±»ï¼š
    ```python
    # python3 è‡ªåŠ¨ç»§æ‰¿ Object ç±»
    class Name:
        # é‡å†™åˆå§‹åŒ–å‡½æ•°
        def __init__(self, arg1, arg2):
            # çˆ¶ç±»åˆå§‹åŒ–
            super().__init__()
        
        # self ä»£è¡¨ç±»å¯¹è±¡è‡ªèº«ï¼Œæ— æ‰€è°“å‘½åï¼Œç”¨äºè°ƒç”¨ç±»çš„æ–¹æ³•
        def func1(self, arg1):
            pass

        # ä¸‹åˆ’çº¿æ³¨æ„ï¼šç”¨åŒä¸‹åˆ’çº¿å¼€å¤´å‘½åæ–¹æ³•æ—¶ï¼Œé»˜è®¤ä¸ºå—ä¿æŠ¤çš„æ–¹æ³•ï¼Œ
        #           Python ä¼šæ·»åŠ ä¸ªç±»å‰ç¼€ä»¥ä¿æŠ¤å‡½æ•°ä¸è¢«å­ç±»è¦†ç›–ï¼Œ
        #           å¦‚ï¼šè¿™é‡Œéœ€è¦ç”¨ a._Name__func2() æ‰èƒ½è®¿é—®è¯¥æ–¹æ³•
        def __func2(self, arg1):
            pass

        # åŒä¸‹åˆ’çº¿åŒ…è£¹æ—¶ï¼Œå‘½åä¸å˜ï¼Œä½œä¸ºå†…ç½®å˜é‡æˆ–æ–¹æ³•
        def __func3__(self, arg1):
            pass

        # å•ä¸‹åˆ’çº¿å¼€å¤´ï¼Œè¡¨ç¤ºæ˜¯å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•æˆ–å‡½æ•°ï¼Œå±äºçº¦å®šä¿—æˆ
        def _func4(self, arg1):
            pass
    ```

https://pythonguidecn.readthedocs.io/zh/latest/writing/structure.html#id14

### å‡½æ•°è¾“å…¥
Python çš„å‡½æ•°/æ–¹æ³•å…è®¸ä¸¤ç§ä¼ å…¥å‚æ•°ï¼šä½ç½®å‚æ•°ã€é”®å€¼å‚æ•°ã€‚ä½ç½®å‚æ•°å°±æ˜¯é€šå¸¸çš„å…¥å‚æ–¹å¼ï¼Œå‡è®¾å®å‚å’Œå½¢å‚æ˜¯æŒ‰é¡ºåºä¸€ä¸€å¯¹åº”çš„ï¼›é”®å€¼å‚æ•°å°±æ˜¯æŒ‡æ˜å½¢å‚å¯¹åº”çš„æ˜¯å“ªä¸ªå®å‚
```python
# a æ˜¯ä½ç½®å‚æ•°
# b æ˜¯é”®å€¼å‚æ•°
def test(a, b=1):
    print(a, b)

# å’Œå‡½æ•°å®šä¹‰ä¸åŒï¼Œå®é™…å¯ä»¥æŒ‰è‡ªå·±å–œæ¬¢ä½¿ç”¨é‚£ç§è¾“å…¥æ–¹å¼ï¼ˆè°ƒç”¨ C åº•å±‚åº“çš„é™¤å¤–ï¼‰
test(1, b=2)
test(a=1, b=2)
test(1, 2)

# é¡ºåºå¿…é¡»è¦å…ˆä½ç½®å‚æ•°å†é”®å€¼å‚æ•°ï¼Œè¿™ç§æƒ…å†µå°±ä¸è¡Œ
test(a=1, 2)
```

\*args ä¿å­˜å‡½æ•°è¾“å…¥å¤šå‡ºæ¥çš„å‚æ•°ï¼Œ\*\*kwargs ä¿å­˜ä½¿ç”¨é”®-å€¼æ–¹å¼è¾“å…¥çš„å¤šä½™å‚æ•°ï¼ŒåŒæ—¶ä½¿ç”¨æ—¶ \*\*kwargs è¦åœ¨ \*args åé¢
```python
def test(*args,**kwargs):
    print(args)
    print(kwargs)
    
test(1,'2',None,c=8,d=12)

# (1, '2', None)
# {'c': 8, 'd': 12}

# è¾“å…¥ä¹Ÿå¯ä»¥é€šè¿‡å­—å…¸æˆ–å…ƒç»„è¾“å…¥
test(*(1, '2', None), **{'c': 8, 'd': 12})
```

å¦å¤–ï¼Œé€šè¿‡åŠ ä¸€ä¸ªå•ç‹¬çš„ `*` ä½œä¸ºå…¥å‚å¯ä»¥é™å®šä½ç½®ç¼–ç çš„èŒƒå›´ï¼Œè¡¨ç¤ºä¹‹åçš„å…¥å‚åªèƒ½é å…³é”®è¯æ¥è¾“å…¥
```python
def test1(a=1, b=2)
    print(a, b)

def test2(a=1, *, b=2):
    print(a, b)

# Works
test1(1,2)

# Not works
test2(1,2)
```


### Duck Typing
> If it walks like a duck, swims like a duck, and quacks like a duck, then it probably is a duck.

ä¸€ç§æ³¨é‡æ–¹ä¾¿çš„ç¼–ç¨‹æ–¹æ³•ï¼Œä¸å»å…³æ³¨å¯¹è±¡çš„ç±»å‹ï¼Œè€Œæ˜¯å…³æ³¨å¯¹è±¡çš„è¡Œä¸ºã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ç¼–ç¨‹ä¸­ä½¿ç”¨å¯¹è±¡æä¾›çš„æ–¹æ³•å’Œç‰¹æ€§ï¼Œè€Œä¸éœ€è¦ç®¡å¯¹è±¡æ˜¯ä¸æ˜¯æœŸæœ›çš„ç±»å‹

![Duck Typing: Any Python, avoiding `isinstance` checkes](ducktyping.webp)

1. https://devopedia.org/duck-typing

### å†…ç½®å˜é‡å’Œå±æ€§æ–¹æ³•
Python ä¸­å¯¹è±¡å’Œå®ä¾‹çš„å±æ€§ä»¥å­—å…¸å½¢å¼ä¿å­˜ï¼Œæœ‰ä¸¤ç§æ–¹æ³•æŸ¥çœ‹ï¼š
1. `vars(module)`ï¼šè¿”å›å½“å‰å¯¹è±¡å•ä¸ªç±»çš„å±æ€§å­—å…¸ï¼Œå…¶å®å°±æ˜¯è¿”å›å®ƒçš„ `__dict__` å¯¹è±¡ã€‚ä¸è¾“å…¥å‚æ•°åˆ™è¿”å›å½“å‰ç¯å¢ƒçš„ç¬¦å·è¡¨
2. `dir(module)`ï¼šè¿”å›å½“å‰å¯¹è±¡å•ä¸ªç±»åŠå…¶åŸºç±»çš„å±æ€§å­—å…¸ï¼Œä¼šè¿”å›æ‰€æœ‰æœ‰æ•ˆå±æ€§ã€‚ä¸è¾“å…¥å‚æ•°åˆ™è¿”å›å½“å‰ç¯å¢ƒçš„æ‰€æœ‰å¯¹è±¡åå­—
3. `eval(str)`ï¼šæŠŠ str å†…å®¹å½“æˆä»£ç æ‰§è¡Œ

å¸¸è§å†…ç½®å˜é‡ï¼š
1. `__all__`ï¼šç”¨äºæ§åˆ¶æ¨¡å—å…¬å¼€çš„æ¥å£çš„å˜é‡ï¼Œ`__all__=["func1", "func2"]` å¯ä»¥è®©æ¨¡å—å¯¼å…¥æ—¶åªå¯¼å…¥åˆ—å‡ºæ¥çš„æˆå‘˜
2. `__base__`ï¼šclass çš„åŸºç±»ï¼Œåªæœ‰ç±»æœ‰ï¼Œå®ä¾‹æ²¡æœ‰ï¼Œå¦‚æœè¦çœ‹åŸºç±»æ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥ `print(inspect.getsource(type(model).__base__.__call__))`
3. `__code__`ï¼šä¸å‡½æ•°ä»£ç å±‚é¢ç›¸å…³çš„å¯¹è±¡ï¼Ÿå¯ä»¥æ˜¾ç¤ºå½“å‰å‡½æ•°çš„æ–‡ä»¶ä½ç½®ï¼Œä»¥åŠå½¢å‚ `__code__.co_varnames`

ä»¥åŒä¸‹åˆ’çº¿åŒ…èµ·æ¥çš„å†…ç½®æ–¹æ³•ä¹Ÿå«é­”æ³•æ–¹æ³•ï¼š
1. `__init__` / `__new__`ï¼šObject è‡ªå¸¦çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œ`__new__` ä¼šè¢«é¦–å…ˆè‡ªåŠ¨è°ƒç”¨ç”¨äºæ„é€ è¿”å›ç±»çš„å®ä¾‹ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥è¿”å›åˆ«çš„ç±»çš„å®ä¾‹ï¼‰ï¼Œ`__init__` åˆ™æ˜¯æ”¹å˜å®ä¾‹çš„çŠ¶æ€è¿”å› Noneã€‚`__new__` å¯ä»¥å†³å®šæ˜¯å¦åç»­è°ƒç”¨ `__init__`ï¼ŒObject çš„è¯é»˜è®¤è°ƒç”¨
2. `__del__`ï¼šåœ¨ç±»è¢«è‡ªåŠ¨åˆ é™¤ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•ï¼Œç±»ä¼¼äºææ„å‡½æ•°


### ç»§æ‰¿
å¤šç±»ç»§æ‰¿æ¶‰åŠé‡å¤è°ƒç”¨ï¼ˆé’»çŸ³/è±å½¢ç»§æ‰¿ï¼‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å…±åŒåŸºç±»ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œpython é€šè¿‡æŸ¥æ‰¾é¡ºåºï¼ˆMROï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ç±»ä¸­é€šè¿‡ `super()` æ¥è°ƒç”¨ MRO çš„ä¸‹ä¸€ä¸ªç±»çš„æ–¹æ³•ï¼Œç¡®ä¿æ¯ä¸€ä¸ªç±»åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå¦‚ï¼š
```python
# å¤šç±»ç»§æ‰¿ï¼Œè¿™äº›ç±»åˆå§‹åŒ–é¦–è¡Œå‡æœ‰ super().__init__()ï¼Œå…±åŒåŸºç±»ä¸º base_parser
class merge_parser(landmarks_parser, face_parser):
	def __init__(self):
		super().__init__()

# åˆå§‹åŒ–è°ƒç”¨é¡ºåºä¸ºï¼š
# start merge_parser
# start landmarks_parser
# start face_parser
# start base_parser
# end base_parser
# end face_parser
# end landmarks_parser
# end merge_parser
parser = merge_parser()


import inspect
inspect.getmro(merge_parser)    # è·å– MRO åˆå§‹åŒ–é¡ºåº
# > (merge_parser, landmarks_parser, face_parser, base_parser)
```
ä¸è¿‡å¤šç±»ç»§æ‰¿è¿˜æ˜¯å­˜åœ¨æ— æ³•å¾ˆå¥½ä¼ å…¥å‚æ•°çš„é—®é¢˜ï¼Œè€Œä¸”ä¹Ÿä¸å¥½ç»´æŠ¤ï¼Œæ‰€ä»¥å®é™…æ¨èé¿å¼€è¿™ç§æ–¹æ³•


### lambda è¡¨è¾¾å¼
åˆ›å»ºåŒ¿åå‡½æ•°ã€‚ç”¨è¡¨è¾¾å¼æ„å»ºå‡½æ•°ï¼Œåªèƒ½è®¿é—®è‡ªæœ‰å‚æ•°ï¼Œæ¯” def å¿«é€Ÿä¾¿æ·  
```python
sum = lambda x1, x2: x1 + x2
sum(2,3)
```


### è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨
- iteratorï¼š
  - åˆ›å»ºï¼š`a = iter(list)` 
  - éå†ï¼š`next(a)`ï¼Œæ— æ³• index?
  - è‡ªå®šä¹‰ï¼šåœ¨ç±»ä¸­å®ç° `__iter__(self)` åˆå§‹åŒ–å’Œ `__next__(self)` å–å€¼æ–¹æ³•åˆ™å¯ä»¥æ„å»ºè¿­ä»£å™¨
- generatorï¼š
  - `yield`


### å¯¹è±¡å˜åŠ¨ï¼ˆObject Mutationï¼‰  
å¯å˜å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ï¼‰èµ‹å€¼åªæ˜¯å¢åŠ åˆ«åï¼Œéƒ½ä¼šæ›´æ”¹åŒä¸€ä¸ªç©ºé—´ã€‚å‡½æ•°å†…éƒ¨ä¿®æ”¹å¤–éƒ¨ä¼ è¿›æ¥çš„å¯å˜å¯¹è±¡å…ƒç´ ä¹Ÿä¸€æ ·æ˜¯ç›´æ¥æ”¹å†…å­˜ã€‚ä½†å½“åœ¨å‡½æ•°å†…é‡æ–°èµ‹å€¼æ—¶ï¼ˆå¦‚ `in_dict = dict(xxx)`ï¼‰ï¼Œä¼ è¿›å‡½æ•°å†…éƒ¨çš„å¯¹è±¡å°±ä¸å†æ˜¯åˆ«åï¼Œè€Œæ˜¯æ–°çš„å¯¹è±¡
```python
>>> a = []
>>> b = [1,2]
>>> a.append(b)
>>> a.append(b)
>>> a.append(b)
>>> a
[[1, 2], [1, 2], [1, 2]]
>>> b[1] = 3
>>> b
[1, 3]
>>> a
[[1, 3], [1, 3], [1, 3]]

# æƒ³è¦ a b ç‹¬ç«‹ï¼Œåº”å½“
a.append(list(b))
```

å¯å˜å¯¹è±¡ä½œä¸ºå…¥å‚æ—¶ï¼Œå‡½æ•°é»˜è®¤å‚æ•°åªä¼šè¿ç®—ä¸€æ¬¡ï¼Œä¸ä¼šæ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°è¿ç®—ï¼š  
```python
def add_to(num, target=[]):
    target.append(num)
    return target
 
add_to(1)
# Output: [1]
 
add_to(2)
# Output: [1, 2]
 
add_to(3)
# Output: [1, 2, 3]
```
å¦‚æœæƒ³è¦æ¯æ¬¡è¿è¡Œæ—¶é‡ç½®ï¼Œåˆ™éœ€è¦å°† `target = None`ï¼Œç„¶ååœ¨å‡½æ•°å†…åˆ›å»ºåˆ—è¡¨

æœ‰æ—¶å€™åœ¨å‡½æ•°å†…éƒ¨éœ€è¦ç¼“å­˜å½“å‰çŠ¶æ€æ—¶åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥å¾ˆæ–¹ä¾¿ï¼ˆç›¸å½“äºåœ¨å‡½æ•°å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé™æ€æ•°ç»„ï¼‰

### ä¸å¯å˜å¯¹è±¡ï¼ˆImmutable Objectï¼‰
ä¹Ÿå«å¯å“ˆå¸Œï¼ˆhashableï¼‰å¯¹è±¡ï¼Œå…¶åœ¨ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šæ”¹å˜ï¼ˆæœ‰ `__hash__()` æ–¹æ³•ï¼‰ï¼Œèƒ½å¤Ÿé€šè¿‡ `__eq__()`Â æˆ–Â `__cmp__()` è¿›è¡Œæ¯”è¾ƒã€‚

å¯å“ˆå¸Œå¯¹è±¡å¯ä»¥ä½œä¸ºå­—å…¸çš„é”®æˆ–é›†åˆçš„å…ƒç´ ï¼ˆåœ¨å†…éƒ¨ä½¿ç”¨å“ˆå¸Œå€¼è¡¨ç¤ºï¼‰ã€‚

å†…ç½®å¯¹è±¡æ˜¯å¯å“ˆå¸Œçš„ï¼Œè‡ªå®šä¹‰ç±»çš„å®ä¾‹å¯¹è±¡é»˜è®¤ä¹Ÿæ˜¯å¯å“ˆå¸Œçš„ï¼ˆå“ˆå¸Œå€¼æ˜¯ `id()`ï¼‰


### åˆ—è¡¨ç»´æŠ¤
å¦‚æœåˆ›å»ºæ–°åˆ—è¡¨ï¼Œå¯ä»¥é‡‡ç”¨åˆ—è¡¨è§£æçš„æ–¹å¼ã€‚æ¯”æ™®é€šå¾ªç¯æ–¹æ³•è¦å¿«ï¼Œå¯åµŒå¥—ï¼Œå­—å…¸ä¹Ÿèƒ½è¿™æ ·ç”¨
```python
a = [ i**2 for i in range(10) if i > 3 ]

# å±•å¼€åµŒå¥—åˆ—è¡¨
a = [b for i in a for b in i]
```

å¦‚æœåªæ˜¯è¦éå†åˆ—è¡¨ï¼Œåº”è¯¥é‡‡ç”¨è¿­ä»£å™¨ï¼Œå¯ä»¥é¿å…è¿‡å¤šçš„å†…å®¹åŠ è½½
```python
# python 3.x
filtered_values = (i**2 for i in range(10) if i > 3)
filtered_values = filter(lambda i: i > 3, range(10))   # æ²¡æœ‰è¾“å‡ºä¹˜æ³•å¤„ç†
```

é€šç”¨çš„è®²ï¼Œè¿™ä¸‰ç§å†…ç½®å‡½æ•°ç»“åˆ lambda å‡½æ•°å¯ä»¥è¾¾åˆ°ä¸€å®šç¨‹åº¦çš„å‡½æ•°å¼ç¼–ç¨‹ï¼š
- `map(func, iterable)`ï¼šå¯¹ iterable é€ä¸ªåº”ç”¨ funcï¼Œè¾“å‡ºç­‰å¤§å° list
- `filter(func, iterable)`ï¼šå¯¹ iterable é€ä¸ªåº”ç”¨ funcï¼Œæ ¹æ® func ç»“æœæ˜¯ true æˆ– false é€‰æ‹©æ˜¯å¦ä¿ç•™è¯¥å…ƒç´ ï¼Œè¿”å›å°äºç­‰äºåŸ list å¤§å°çš„æ–° list
- `functools.reduce(func, sequence[, initial])`ï¼šfunc è¾“å…¥ä¸Šæ¬¡ç»“æœå’Œè¿™æ¬¡å…ƒç´ ï¼Œè®¡ç®—ç´¯è®¡ç»“æœä¼ é€’ç»™ä¸‹ä¸ªè¾“å…¥ï¼Œéå†æ•°ç»„ï¼Œå¯ä»¥å®ç°ç´¯ä¹˜ç´¯åŠ ï¼Œè¿”å›å•ä¸ªå€¼

### åç¨‹
ç±»ä¼¼ä¸­æ–­ï¼Œå®ƒå…è®¸åœ¨å‡½æ•°æ‰§è¡Œä¸­è·³è½¬æ‰§è¡Œå…¶ä»–å‡½æ•°ï¼Œå­ç¨‹åºæ˜¯åç¨‹çš„ä¸€ç§ç‰¹ä¾‹  
- `yield`ï¼šç”Ÿæˆå™¨å°±æ˜¯åç¨‹çš„ä¸€ç§å®ç°
- `async/await`ï¼špython3.5 åŠ å…¥çš„å…³é”®å­—ï¼Œé€šè¿‡ `async def func():` æ¥è¡¨ç¤ºå®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå†…éƒ¨å¯ä»¥è®¾ç½®æŒ‚èµ·æ¡ä»¶ã€‚åœ¨å¼‚æ­¥å‡½æ•°ä¸­é€šè¿‡ `res = await func()` æ¥è¡¨ç¤ºæŒ‚èµ·å½“å‰å¼‚æ­¥å‡½æ•°ï¼Œç­‰å¾… `func()` è¿”å›ç»“æœ

å‚è€ƒï¼š  
1. https://www.cnblogs.com/dhcn/p/9032461.html
2. https://www.cnblogs.com/xinghun85/p/9937741.html


### é—­åŒ…
Python å‡½æ•°å†…éƒ¨å…è®¸åµŒå¥—å‡½æ•°ï¼Œå¦‚æœå†…éƒ¨çš„å‡½æ•°ä½¿ç”¨äº†å¤–éƒ¨å‡½æ•°æä¾›çš„ä¸´æ—¶å˜é‡ï¼ˆå†…éƒ¨å‡½æ•°çš„éå±€éƒ¨å˜é‡ï¼‰ï¼Œç„¶åè¿”å›å¤–éƒ¨å‡½æ•°è¿”å›å€¼ä¸ºå†…éƒ¨å‡½æ•°ï¼Œåˆ™å½¢æˆäº†é—­åŒ…ï¼Œè¯¥å¤–éƒ¨å˜é‡è¢«ç»‘å®šæˆäº†å€¼æˆ–åœ¨å­˜å‚¨ç©ºé—´ä¸­ï¼Œä¹Ÿå°±ç›¸å½“äºå†…éƒ¨å‡½æ•°è¢«å®ä¾‹åŒ–åˆ›å»ºäº†

```python
def f(x):
    def g(y):
        return x + y
    return g  # Return a closure.

def h(x):
    return lambda y: x + y  # Return a closure.

# Assigning specific closures to variables.
a = f(1)
b = h(1)

# Using the closures stored in variables.
assert a(5) == 6
assert b(5) == 6

# Using closures without binding them to variables first.
assert f(1)(5) == 6  # f(1) is the closure.
assert h(1)(5) == 6  # h(1) is the closure.
```

éœ€è¦æ³¨æ„ï¼ŒPython çš„é—­åŒ…æ˜¯ _late binding_ çš„ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶æ‰ä¼šå»å¯»æ‰¾å†…éƒ¨å˜é‡çš„å€¼ï¼Œè¿™æ„å‘³ç€ä¸èƒ½å¤Ÿä¸€ä¸² for å¾ªç¯åˆ›å»ºå‡½æ•°åˆ—è¡¨

```python 
cc = [lambda x : i * x for i in range(5)]
cc[0](2)
# return: 8
cc[1](2)
# return: 8


def create_multipliers():
    multipliers = []
    for i in range(5):
        def multiplier(x):
            return i * x
        multipliers.append(multiplier)
    return multipliers
cc = create_multipliers()
cc[0](2)
# return: 8
cc[1](2)
# return: 8
```

å‚è€ƒï¼š  
https://docs.python-guide.org/writing/gotchas/#late-binding-closures


### è£…é¥°å™¨
å¦‚æœæœ‰ä¸€äº›å‡½æ•°åŠŸèƒ½é€»è¾‘ä¹‹å¤–çš„äº‹æƒ…è¦åšï¼Œæˆ–è€…è¯´éœ€è¦æ§åˆ¶å‡½æ•°çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ—¥å¿—ã€æˆæƒä¹‹ç±»çš„ï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¥å®ç°ä»¥ä¿æŒä»£ç çš„ç®€æ´æ¸…æ™°

å¤§è‡´æ„æ€å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°å‡½æ•°å»åŒ…è£…è¯¥å‡½æ•°

```python
from functools import wraps

def cal_time(func):
    @wraps(func)   # è®© wrap_func ä½¿ç”¨ func çš„å‡½æ•°ä¿¡æ¯çš„è£…é¥°å™¨
    def wrap_func(*args, **kwargs):
        start = time()
        res = func(*args, **kwargs)
        end = time()
        print('time:', end-start)
        return res
    return wrap_func

@cal_time
def process(a, b):
    return a + b

process(1,2)
# Output: time: 7.152557373046875e-07
# Output: 3

# @ åé¢è·Ÿä»¥ func ä¸ºå‚æ•°çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å†åŠ ä¸€å±‚ä½¿è£…é¥°å™¨å¸¦å‚æ•°
def benchmark(cuda=False):
    def cal_time(func):
        @wraps(func)   # è®© wrap_func ä½¿ç”¨ func çš„å‡½æ•°ä¿¡æ¯çš„è£…é¥°å™¨
        def wrap_func(*args, **kwargs):
            if cuda:
                torch.cuda.synchronize()
            start = time()
            res = func(*args, **kwargs)
            if cuda:
                torch.cuda.synchronize()
            end = time()
            print('time:', end-start)
            return res
        return wrap_func
    return cal_time

@benchmark(True)
def process(a, b):
    return a + b


# ä¸€äº›å†…å»ºçš„è£…é¥°å™¨
class X():
    # ç±»æ–¹æ³•ï¼Œå¯ä»¥ X.func1() ç›´æ¥è°ƒç”¨ï¼Œå…è®¸é€šè¿‡ cls æ¥è·å–è°ƒç”¨ç±»çš„ä¸€äº›å±æ€§æˆ–æ–¹æ³•ï¼Œé¿å…ç¡¬ç¼–ç 
    @classmethod
    def func1(cls, arg1, arg2):
        pass
    
    # é™æ€æ–¹æ³•ï¼Œå¯ä»¥ X.func1() ç›´æ¥è°ƒç”¨ï¼Œæ— æ³•è®¿é—®ç±»çš„å±æ€§çŠ¶æ€
    @staticmethod
    def func2(arg1, arg2):
        pass
```

ç±»å’Œå¯¹è±¡ä¹Ÿå¯ä»¥ç”¨ä½œè£…é¥°å™¨ï¼Œä¼šæ›´åŠ çµæ´»
```python
class luminance_inference():
    def __init__(self, f):
        self.f = f

    def __call__(self, x, *args):
        x, recov_uv = rgb_to_luminance(x)
        y = self.f(x, *args)
        y = luminance_to_rgb(y, recov_uv)
        return y

@luminance_inference
def forward(x):
    return x
```

ä¸€äº›æœ‰ç”¨çš„è£…é¥°å™¨ï¼š
- `@functools.lru_cache(maxsize=128)`ï¼šå‡½æ•°ç¼“å­˜è£…é¥°å™¨ï¼Œä¼šç¼“å­˜ `maxsize` ä¸ªç»“æœï¼Œå‡½æ•°çš„å›ºå®šå‚æ•°å’Œå…³é”®å­—ä¼šç”¨å­—å…¸ç¼“å­˜ä¸‹æ¥ï¼Œå¦‚æœç›¸åŒå°±ä¼šè¿”å›ä¸Šæ¬¡çš„ç»“æœã€‚ä¸è¿‡è¿™ä¸ªè£…é¥°å™¨ä¸èƒ½ç”¨åœ¨ numpy array ä¸Šï¼Œå¦‚éœ€ç”¨äºå¤æ‚è¿”å›å€¼ä¸Šå¯ä»¥è€ƒè™‘ [[Python#Python#Joblib|Joblib]]

é—®é¢˜ï¼š
1. åœ¨ç±»æ–¹æ³•é‡Œä½¿ç”¨è£…é¥°å™¨æœ‰å¾ˆå¤šè¦æ³¨æ„äº‹é¡¹ï¼Œæš‚ä¸”æ²¡ææ‡‚ï¼Œæ€»ä¹‹å¾ˆéš¾ç”¨


å‚è€ƒï¼š  
1. https://www.runoob.com/w3cnote/python-func-decorators.html


### æ³¨å†Œ
https://applenob.github.io/python/register/


### åƒåœ¾å›æ”¶
Python ä¸»è¦é‡‡ç”¨å¼•ç”¨è®¡æ•°ï¼Œè¾…ä»¥ æ ‡è®°-æ¸…ç† å’Œåˆ†ä»£å›æ”¶ç­–ç•¥ã€‚  

å¯¹è±¡å¼•ç”¨è®¡æ•° +1 çš„æƒ…å†µï¼š  
1. å¯¹è±¡è¢«åˆ›å»º
2. å¯¹è±¡è¢«å¼•ç”¨ `b = a`
3. å¯¹è±¡è¢«ä¼ å…¥å‡½æ•°ä¸­
4. å¯¹è±¡è¢«å­˜è¿›å®¹å™¨ä¸­  

å¯¹è±¡å¼•ç”¨è®¡æ•° -1 çš„æƒ…å†µï¼š  
1. åˆ«åè¢«æ˜¾å¼é”€æ¯ `del a`
2. å¼•ç”¨å…¶ä»–å¯¹è±¡ `b = a` => `b = c`ï¼Œa å¼•ç”¨ -1
3. ç¦»å¼€ä½œç”¨åŸŸ
4. å®¹å™¨è¢«é”€æ¯ï¼Œæˆ–å…ƒç´ è¢«åˆ é™¤

é—®é¢˜ï¼š  
è€—èµ„æºï¼ˆå¼•ç”¨ä¸€æ¬¡æ”¹ä¸€æ¬¡ï¼‰ã€æ— æ³•é‡Šæ”¾å¾ªç¯å¼•ç”¨ï¼ˆ`a, b = b, a`ï¼‰  

è§£å†³ï¼š  
ä½¿ç”¨ æ ‡è®°-æ¸…ç† å°†å®¹å™¨å†…å…ƒç´ åˆ†ä¸º reachable å’Œ unreachableï¼ˆå¯¹è±¡é—´æ„å»ºæœ‰å‘å›¾ï¼Œä» root object ï¼ˆå…¨å±€å˜é‡ã€è°ƒç”¨æ ˆã€å¯„å­˜å™¨ï¼‰å‡ºå‘ï¼Œèƒ½æŠµè¾¾çš„å°±æ˜¯ reachableï¼Œå¦åˆ™ unreachableï¼‰ï¼Œæ¸…ç† unreachableã€‚æ¸…ç†çš„æ—¶æœºä½¿ç”¨åˆ†ä»£å›æ”¶ï¼Œå³æ ¹æ®å­˜æ´»æ—¶é—´ç»™å¯¹è±¡åˆ†ä»£ï¼ŒæŒ‰ç‰¹å®šç­–ç•¥è§¦å‘åƒåœ¾å›æ”¶


è¯¦ç»†å‚è€ƒï¼š
1. https://blog.csdn.net/xiongchengluo1129/article/details/80462651  
2. https://segmentfault.com/a/1190000016078708

### å†…çœï¼ˆIntrospectionï¼‰å’Œåå°„ï¼ˆReflectionï¼‰
å¤§è‡´æ„æ€éƒ½æ˜¯ç¨‹åºåœ¨ __è¿è¡Œæ—¶__ å»æŸ¥çœ‹æˆ–ä¿®æ”¹ä¸€ä¸ª __ä¸ç¡®å®šæ˜¯å¦å­˜åœ¨__ çš„å¯¹è±¡ï¼Œå‰è€…åªèƒ½æ£€æŸ¥ï¼Œåè€…å…è®¸ä¿®æ”¹ã€‚Python ä¸­é€šè¿‡ `getattr(obj, str)`ã€`setattr(obj, str, val)` ç­‰æ¥å®ç°
> The ability to inspect the code in the system and see object types is not reflection, but rather Type Introspection. Reflection is then the ability to make modifications at runtime by making use of introspection. The distinction is necessary here as some languages support introspection, but do not support reflection. One such example is C++.

`setattr(object, name, value)`ï¼šåŠŸèƒ½ä¸Šç±»ä¼¼äº `object.name=value`ï¼Œç»™å¯¹è±¡è®¾ç½®å±æ€§å€¼ï¼Œè¯¥å±æ€§å¯ä»¥ä¸å­˜åœ¨ï¼ˆæ–°å»ºï¼‰ï¼Œä¸è¿‡è¿™é‡Œ `name` ä¸ºå­—ç¬¦ä¸²  
`getattr(object, name[, default])`ï¼šåŒä¸Šï¼Œå±äºæŒ‰å±æ€§åç´¢å¼•

### å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹
å¤šçº¿ç¨‹ `threading`ï¼Œå¤šè¿›ç¨‹ `multiprocessing`ã€‚ç”±äº Python ä¸€èˆ¬ä½¿ç”¨ CPython ä½œä¸ºè§£é‡Šå™¨ï¼Œè€Œ CPython æœ‰ GIL çš„å­˜åœ¨ï¼ˆä¸€æ—¶é—´åªèƒ½ä¸€æ ¸åœ¨è·‘ï¼‰ï¼Œæ‰€ä»¥æ— æ³•åœ¨ Python å±‚é¢å®æ–½çœŸæ­£çš„å¤šçº¿ç¨‹ã€‚å¦‚æœåŒæ­¥å’Œé€šä¿¡é—®é¢˜ä¸æ˜¯å¾ˆä¸¥é‡ï¼Œä½¿ç”¨å¤šè¿›ç¨‹ä¼šä¸é”™ï¼Œæ¯ä¸ªè¿›ç¨‹ä¼šæœ‰ä¸€ä¸ª GILï¼Œä½†ä¸ä¼šäº’ç›¸å½±å“
```python
# å¤šè¿›ç¨‹ä¸‹ numpy ç§å­å¯èƒ½ç›¸åŒï¼Œéšæœºå‡½æ•°æˆ–ç§å­è®¾ç½®åº”é‡‡ç”¨ python çš„ random
import random
# ä½¿ç”¨ pickle æ¥åºåˆ—åŒ–å…¥å‚ï¼Œæ”¹ç”¨ multiprocess å¯ä»¥æœ‰æ›´å¼ºçš„åºåˆ—åŒ–èƒ½åŠ›
import multiprocessing

def func(x):
  pass
  
def func_wrapper(z):
  func(z[0], z[1], ...)

if __name__ == '__main__':
    # å•è¿›ç¨‹å¤„ç†
    for x in list_v:
      func(x)

    # ç®€æ˜“ä½¿ç”¨ï¼Œ8 è¿›ç¨‹å¤„ç†
    pool = multiprocessing.Pool(8)
    
    # å°† list_v æ¢ä¸º [(arg1, arg2), (arg1, arg2), ...] çš„äºŒç»´æ•°ç»„ï¼Œ
    # å†å¥—ä¸€å±‚ wrapper è§£æå…¥å‚ï¼Œå†ä¼ å…¥åˆ° func ä¸­å³å¯å¤„ç†å¤šä¸ªå‚æ•°
    # ï¼ˆç±»ä¼¼ Tensorflow çš„æ•°æ®é¢„å¤„ç†ï¼‰
    pool.map(func, list_v)
    pool.close()
    pool.join()
```
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸èƒ½å¤šä¸ªè¿›ç¨‹å¯¹åŒä¸€å…¨å±€å˜é‡åšä¿®æ”¹ï¼ˆåœ¨å„ä¸ªè¿›ç¨‹ä¸­ä¼¼ä¹ä¼šæ‹·è´ä¸€ä»½å…¨å±€å˜é‡è¿›å»ï¼Œç„¶åæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªä»…å¯¹è‡ªå·±è¿›ç¨‹å¯è§çš„å…¨å±€å˜é‡ï¼Œæœ€ç»ˆä¿®æ”¹çš„ç»“æœä¹Ÿåªå½±å“æ‹·è´çš„å˜é‡ï¼Œä¸ä¼šæ”¹å˜ä¸»è¿›ç¨‹çš„å…¨å±€å˜é‡ï¼‰  
å¦‚éœ€å…±äº«èµ„æºä½¿ç”¨  `Multiprocessing.Queue`ã€`Multiprocessing.Array`ã€`Multiprocessing.Manager` 

å­è¿›ç¨‹çš„æ„å»ºæ–¹å¼åŒ…å« fork å’Œ spawnï¼Œè¿˜æœ‰ä¸€ç§ forkserver ä¼¼ä¹æ˜¯ä¸¤è€…çš„æ··åˆç®¡ç†ï¼š
- forkï¼šå­è¿›ç¨‹ä½¿ç”¨çˆ¶è¿›ç¨‹å…±äº«çš„å†…å­˜ï¼Œåªä¼šå¯¹ä¿®æ”¹éƒ¨åˆ†å†™æ—¶å¤åˆ¶ï¼Œé€Ÿåº¦å¿«ï¼Œä¸è¿‡å¦‚æœé•¿æ—¶é—´è¿è¡Œä¿®æ”¹çš„å°èµ„æºå¤šä¼šå¯¼è‡´å†…å­˜æ¶¨å¾—å‰å®³ã€‚Unix ç±»ä»¥åŠ MacOSï¼ˆpython3.8 ä»¥ä¸‹ï¼‰é»˜è®¤ç”¨è¿™ç§æ–¹å¼ï¼ŒWindows ä¸æ”¯æŒã€‚å¦å¤–ï¼Œè¯¥æ–¹å¼ä¼šå¤åˆ¶ numpy éšæœºç§å­ï¼Œä¼šå‡ºç°å¤šè¿›ç¨‹ä½¿ç”¨åŒä¸€ä¸ªç§å­çš„æƒ…å†µ
- spawnï¼šå­è¿›ç¨‹ä»å¤´æ„å»ºï¼Œå¤åˆ¶çˆ¶è¿›ç¨‹æ•°æ®ï¼Œç›¸å½“äºå†è·‘ä¸€ä¸ªç¨‹åºï¼Œé€Ÿåº¦æ…¢ã€‚Windows ä»¥åŠ MacOSï¼ˆpython3.8 åŠä»¥ä¸Šï¼‰é»˜è®¤è¿™ç§æ–¹å¼
- è¡¥å……èµ„æ–™ï¼š https://bnikolic.co.uk/blog/python/parallelism/2019/11/13/python-forkserver-preload.html

åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ VSCode ä¸Šè°ƒè¯•ï¼‰ä¼¼ä¹åªèƒ½ç”¨ spawn

jupyter ä¸Šå¤šè¿›ç¨‹å¯è§ [[Python#jupyter]]

`multiprocessing.Pool` çš„ä½¿ç”¨è¯´æ˜ï¼š
- `apply(f, *args)`ï¼šä½¿ç”¨è¿›ç¨‹æ± çš„ä¸€ä¸ªè¿›ç¨‹è·‘ä¸€ä¸ªå‡½æ•°ï¼Œé˜»å¡ã€‚éé˜»å¡ç‰ˆæœ¬ `apply_async`
- `map(f, *args)`ï¼šä½¿ç”¨è¿›ç¨‹æ± å¹¶è¡Œè·‘ä¸€ä¸ªå‡½æ•°ï¼Œé˜»å¡ã€‚éé˜»å¡ç‰ˆæœ¬ `map_async`
- `imap(f, *args)`ï¼šç±»ä¼¼ `apply`

1. https://discuss.python.org/t/differences-between-pool-map-pool-apply-and-pool-apply-async/6575


### is å’Œ is not
ç±»ä¼¼ `==`ã€`!=`ï¼Œä¸è¿‡ `is` å’Œ `is not` æ¯”è¾ƒåœ°å€  
```python
a="hello"
b="hello"
print(a is b, a == b)   # è¾“å‡ºä¸º True, True

a=["hello"]
b=["hello"]
print(a is b, a == b)   # è¾“å‡ºä¸º False, True
```
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`==` å¯èƒ½ä¼šè¢«é‡è½½ï¼ˆå¦‚ numpy é‡Œä¼šè¿”å› keep_dims çš„ bool æ•°ç»„ï¼‰ï¼Œè¿™æ ·å°±ä¸èƒ½ç”¨ `a == None` å¯¹ `a` åˆ¤åˆ«ï¼ˆé‡è½½åå¯¹å…ƒç´ è¿›è¡Œé€ä¸ªåˆ¤åˆ«ï¼‰ï¼Œè€Œ `a is None` å¯ä»¥ï¼Œæ‰€ä»¥åˆ¤åˆ«å¯¹è±¡æ˜¯å¦å­˜åœ¨ä¸€èˆ¬éƒ½ç”¨ `is None`

### None å’Œ False
if è¯­å¥é‡Œå¯ä»¥åˆ¤æ–­ ç©ºæ•°æ®ã€`0`ã€`False` å’Œ `None` éƒ½ä¸ºå‡ï¼Œä½¿ç”¨ `is` åˆ¤æ–­çš„è¯å®ƒä»¬éƒ½æ˜¯ä¸åŒçš„
```python
a = []
b = 0
c = False
d = None

if a or b or c or d:
	# not enter
	pass

0 == False  # True
1 == True   # True
2 == True   # False
```

### with...as...
å¯ä»¥ç”¨äºæ‰“å¼€æ–‡ä»¶ï¼ˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼‰ï¼Œè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾èµ„æºï¼Œä¿è¯æ“ä½œç»“æŸåæ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½èƒ½è‡ªåŠ¨å…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡ç±»é‡Œå®ç° `__enter__`  å’Œ `__exit__` æ–¹æ³•æ¥è‡ªåˆ¶ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `contextlib` æ¥è£…é¥°ç”Ÿæˆå™¨åšæˆç®€æ˜“çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨
```python
with open('xxx.txt', 'w+') as f:
	f.write(str)
```

https://pythonguidecn.readthedocs.io/zh/latest/writing/structure.html#id12


### ç±»å‹æ³¨è§£
ç±»å‹æ³¨è§£æ˜¯ Python 3.5 åå¼•å…¥çš„åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºæ ‡æ³¨å¯¹è±¡çš„ç±»å‹ï¼Œä½¿ç”¨æ–¹æ³•ç±»ä¼¼ `a: int = 3`ï¼Œå¸¸ç”¨äºæ ‡æ³¨å‡½æ•°æ–¹æ³•çš„è¾“å…¥è¾“å‡ºå˜é‡ç±»å‹ï¼Œä»¥æ–¹ä¾¿ç¼–è¾‘å™¨æ£€æŸ¥ã€‚å…·ä½“ç±»å‹æ ‡å‡†å¯ä»¥åœ¨ `typing` åº“ä¸­æ‰¾åˆ°
```python
from typing import List

# å¤åˆç±»å‹æ³¨è§£
a: List[int] = [0, 3]

# Python 3.9+ å¯ä»¥ä¸éœ€è¦ typing åº“
a: list[int] = [0, 3]

# ä¹Ÿå¯ä»¥åœ¨å†…ç½®æ„å»ºå‡½æ•°æ—¶æ·»åŠ æ³¨è§£
a = dict[int, list[int]]()

# æ›´é«˜çº§çš„è¿˜å¯ä»¥ä½¿ç”¨æ³›å‹æ¥å¤„ç†å¤æ‚çš„å¤šç±»å‹æ”¯æŒå’Œå¤šå‚æ•°åŒæ­¥ç±»å‹é—®é¢˜
```

é€šè¿‡ `.pyi` stub file å¯ä»¥ç»™å‡½æ•°æŒ‡å®šç±»å‹ï¼Œä»è€Œè®© Pycharm ç­‰ç¯å¢ƒè¿›è¡Œç±»å‹æ£€æŸ¥è€Œéè¿è¡Œæ—¶åŠ¨æ€æ£€æŸ¥ã€‚åå­—è¦ç›¸åŒï¼Œä¸”åœ¨ `PATH` ä¸­ https://www.cnblogs.com/chester-cs/p/14000921.html

https://zhuanlan.zhihu.com/p/419955374


### å¼‚å¸¸å¤„ç†
éµå¾ª Fail-Fast åŸåˆ™ï¼Œä¸è¦é™é»˜å¤„ç†ï¼Œä¸è¦ç”¨é»˜è®¤å¤„ç†çº æ­£ï¼Œé™¤éæ˜ç¡®çŸ¥é“æ€ä¹ˆå¤„ç†ã€‚å¯¹äºæ„æƒ³å¤–æƒ…å†µçš„è¾“å…¥ï¼Œä¸è¦æ•è·ï¼ŒLet it Crashï¼Œè®©ä¸Šå±‚è§£å†³
```python
# ç›´æ¥æŠ›å‡ºå¼‚å¸¸
if xxx:
	raise RuntimeError('asdasdsa')

# å¼‚å¸¸æ•è·ä»¥åŠæ‰“å°ä¿¡æ¯
import traceback
try:
	Image.open('xxx.jpg')
except IOError:
    xxx
except Exception as e:
    print(repr(e))                    # æ‰“å°é”™è¯¯ï¼ˆæ— è½¬ä¹‰ï¼‰
    print(traceback.print_exc())      # æ‰“å°å®Œæ•´ traceback
else:								  # æ— è¯¯çš„è¯
	xxx
finally:
    xxx								  # æ— è®ºæ­£ç¡®é”™è¯¯ä¸€å®šä¼šæ‰§è¡Œçš„éƒ¨åˆ†


# æ–­è¨€ï¼Œç”¨ python -O æ‰§è¡Œå¯å¿½ç•¥
assert(xxx == 'asd')
```

https://dzone.com/articles/fail-fast-principle-in-software-development

### æ€§èƒ½åˆ†æ
ä½¿ç”¨ dis æ¨¡å—å¯ä»¥åˆ†æå­—èŠ‚ç 
```python
import dis
dis.dis(func)
```

### æ­£åˆ™è¡¨è¾¾å¼
ä½¿ç”¨ re æ¨¡å—
```python
import re
# å› ä¸º re çš„è¾“å…¥ pattern éœ€è¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ï¼Œè€Œæ­£åˆ™è¡¨è¾¾å¼å’Œ ASCII çš„è½¬ä¹‰å­—ç¬¦éƒ¨åˆ†å†²çª
# æ‰€ä»¥éœ€è¦åœ¨ pattern string å‰åŠ ä¸Š r è¡¨ç¤º raw string ä¸å¤„ç†è½¬ä¹‰å­—ç¬¦å¾—åˆ°åŸå§‹å­—ç¬¦ï¼Œç”¨äº
# æ­£åˆ™åŒ¹é… 
res = re.match(r'model\.stage\d\.', key)

# ä¸ä¸Šé¢åŒç»“æœçš„å¦ä¸€ç§å†™æ³•ï¼Œç¨é«˜æ•ˆäº›
prog = re.compile(pattern)
result = prog.match(key)

# å°† key ä¸­ç¬¦åˆ prog pattern çš„å­—ç¬¦ä¸²æ›¿æ¢æˆ xx
prog.sub('xx', key)

# è½¬ä¹‰å­—ç¬¦
re.escape(' vv/n ')  # '\ vv/n\ '

# è¿”å›æ•è·ç»„ï¼Œ0 è¡¨ç¤ºåŒ¹é…çš„å­—ç¬¦ï¼Œ1 è¡¨ç¤ºç¬¬ä¸€ä¸ªæ•è·ç»„ï¼Œ2 è¡¨ç¤ºç¬¬äºŒä¸ªæ•è·ç»„ï¼Œå¦‚æ­¤ç±»æ¨
res.group(0)
```

### æ—¥å¿—ç³»ç»Ÿ
Python ä½¿ç”¨ `logging` åº“ä½œä¸ºæ ‡å‡†æ—¥å¿—è®°å½•å·¥å…·ï¼Œå…¶æ ¼å¼åŒ–ç­‰å¤„ç†é€šè¿‡ handler å®ç°ï¼Œå¸¸ç”¨çš„ handler æœ‰ï¼š
- `StreamHandler`ï¼šå°†è¾“å‡ºæµå‘é€åˆ°æ ‡å‡†è¾“å‡ºæˆ–æ–‡ä»¶å¯¹è±¡ç­‰æ”¯æŒ `write()` å’Œ `flush()` çš„å¯¹è±¡ä¸Š
- `NullHandler`ï¼šä¸ä¼šå¤„ç†æˆ–è¾“å‡ºï¼Œå¯ä»¥ç”¨æ¥é™é»˜ç›¸å…³æ—¥å¿—è€Œä¸ç”¨å¤§é‡æ”¹ä»£ç 

å¼€å‘åº“æ—¶ï¼Œåº”å½“å°† logger è®¾ç½®æˆ NullHandler `logging.getLogger(__name__).addHandler(NullHandler())`ï¼Œä¼¼ä¹å¯ä»¥å°†åº“çš„æ—¥å¿—è¾“å‡ºäº¤ç”±ç”¨æˆ·è®¾ç½®å†³å®š


1. https://realpython.com/python-logging-source-code/#library-vs-application-logging-what-is-nullhandler


### \_\_future\_\_ æ¨¡å—
å¯ä»¥å°†æ–°ç‰ˆæœ¬ python çš„ç‰¹æ€§å¯¼å…¥åˆ°å½“å‰ç‰ˆæœ¬ä¸­ä½¿ç”¨


### å…³äº Unicodeã€str å’Œ bytes
æ ‡å‡† ASCII ç  0 ~ 127 è¡¨ç¤ºå­—ç¬¦ï¼Œæœ€é«˜ä½ç•™ä½œå¥‡å¶æ ¡éªŒï¼ˆä½¿å­—èŠ‚çš„ä½ç´¯åŠ å’Œä¸ºå¥‡/å¶æ•°ï¼‰ï¼Œå 128 ä¸ºæ‰©å±•ç ã€‚ä¸ºè¡¨ç¤ºæ›´å¤šè¯­è¨€ï¼Œç”¨ä¸¤ä¸ªå­—èŠ‚æ¥ç¼–ç ï¼Œå¦‚ GB2312ã€‚

Unicode åˆ™æ˜¯ç»Ÿä¸€å¤šç§è¯­è¨€çš„å­—ç¬¦é›†ï¼Œæ¯ä¸ªå­—ç¬¦å¯¹åº”å››å­—èŠ‚å†…çš„ IDï¼ˆæˆ–ç§° code pointï¼‰ï¼Œå…¶ç¼–ç æ–¹å¼ï¼ˆå‡ºäºä¼ è¾“ä½¿ç”¨å’Œå‹ç¼©å¸¸ç”¨å­—ç¬¦ç­‰ç›®çš„ï¼‰æœ‰ UTF-8ï¼ˆä»¥ 8 ä½ä¸ºå•ä½çš„å¯å˜é•¿ç¼–ç ï¼‰ç­‰ã€‚

åœ¨ python2.x ä¸­ï¼Œ`a = 'asd'` å’Œ `a = u'asd'` åˆ†åˆ«æ˜¯ str å’Œ unicode ç±»å‹ï¼Œè€Œåœ¨ python3.x ä¸­ä¸¤è€…éƒ½æ˜¯ str å¯¹è±¡ç±»å‹ï¼ˆä¼¼ä¹éƒ½æ˜¯ unicode çš„ code point å½¢å¼ï¼Œéƒ½è§†ä¸º unicode stringï¼‰ã€‚è€Œ UTF-8 è¡¨ç¤ºåˆ™æ˜¯å­—èŠ‚å½¢å¼ï¼Œæ¯”å¦‚ UTF-8 å­—èŠ‚ `0x30` ä»£è¡¨ unicode å­—ç¬¦ `0` ã€‚

è‹¥è¦ä¿å­˜åˆ™éœ€è¦ç¼–ç ä¸º bytes ç±»å‹ï¼ˆç›¸å½“äºå­—èŠ‚ç»„æˆçš„æ•°ç»„ï¼‰ï¼Œé€šè¿‡ `a.encode('utf-8')` å®ç°ï¼Œæ­¤æ—¶å®ƒçš„é•¿åº¦å°†ä¼šæ˜¯å¦‚å®çš„å­—èŠ‚æ•°ã€‚

å¯¹äº `a.encode("ascii", "xmlcharrefreplace")` è¿˜æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥æä¾›æ— æ³•è¢«ç›¸åº”è§„åˆ™ç¼–ç çš„æƒ…å†µä¸‹çš„å¯¹ç­–ã€‚  
_æ³¨ï¼šå­—ç¬¦ä¸²æ ‡å¿— `r'xxx'` è¡¨æ˜ç”¨åŸå§‹å­—ç¬¦ä¸è½¬ä¹‰ï¼ˆæ¯”å¦‚æ¢è¡Œç”¨â€åæ–œæ +nâ€œè¡¨ç¤ºï¼‰ï¼Œ`f'xxx{a:.2f}'` è¡¨æ˜ f-stringï¼Œå­—ç¬¦ä¸²å†…å¯ä»¥ç”¨å¤§æ‹¬å·æ¥å¼•å…¥å¤–éƒ¨å˜é‡ï¼Œ`b'xxx'` è¡¨æ˜æ˜¯ bytes å¯¹è±¡_

æ›´å¤šèµ„æ–™ï¼šhttps://pycoders-weekly-chinese.readthedocs.io/en/latest/issue5/unipain.html

è½¬æ¢æ–¹æ³•æ±‡æ€»å¦‚ä¸‹ï¼š
```python
str_a = 'asd'
int_a = -4
arr_a = np.array([4.2, 3.1])
byt_a = b'asd'

# è½¬ bytes
b = str_a.encode('utf-8')
b = int_a.to_bytes(4, sys.byteorder, signed=True)
b = arr_a.to_bytes()  # åŒ bytes(arr_a)
b = bytearray(byt_a) # å¯å†™çš„å­—èŠ‚æ•°ç»„ï¼Œç”¨äºå­—èŠ‚è¿ç®—

# bytes è½¬
str_a = b.decode('utf-8')
int_a = struct.unpack('1i', b)
arr_a = struct.unpack('2d', b)

# åå…­è¿›åˆ¶å­—ç¬¦è½¬ bytes
bytes.fromhex('E1B3')
```

å­—ç¬¦ä¸²å¯¹é½æ–¹æ³•ï¼š
```python
print("%-70s \t %s" % (s1, s2))  # å°† s1 å­—ç¬¦ä¸²å·¦å¯¹é½å¡«å……åˆ° 70 å­—ç¬¦
print(f"{s1:<15}")               # å·¦å¯¹é½å  15 å­—ç¬¦ï¼Œæœ€å¥½å°†ä¸èƒ½å¯¹é½çš„å˜é‡æ‰“å°æ”¾åˆ°æœ€åé¢
```

å­—ç¬¦è½¬ä¹‰ï¼š
```python
re.escape('x.out.')
# > 'x\\.out\\.'

```

ç¼–ç é”™è¯¯é—®é¢˜ï¼š
1. é¦–å…ˆè§‚å¯Ÿç»“æ„ï¼šå¦‚æœæ˜¯ç±»ä¼¼ `\123\432\142` çš„æ ¼å¼ï¼Œè¯´æ˜æ˜¯ Unicode ç ï¼Œè¿™é‡Œæ˜¯ 8 è¿›åˆ¶ Unicodeï¼Œè€Œä¸”å¯èƒ½æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå ä¸‰ä¸ª unicodeï¼‰ï¼›å¦‚æœæ˜¯ä¹±ç å­—ç¬¦è¯´æ˜æ˜¯è¢«è§£ç è¿‡äº†ï¼Œéœ€è¦å…ˆç”¨ `.encode('utf-8')` ä¹‹ç±»çš„ç¼–ç å› bytes
2. ç„¶åè½¬æ¢æˆ 16 è¿›åˆ¶çš„ç¼–ç  bytesï¼Œä¹Ÿå°±æ˜¯æ‰‹åŠ¨ç¼–ç ã€‚å¦‚æœæ˜¯ `\123\432\142` çš„è¯å¯ä»¥ `[bytes.fromhex(hex(int(code, 8))[2:]) for code in octal_code.split('\\')[1:]]` æŠŠé€ä¸ª Unicode ç è½¬æˆåå…­è¿›åˆ¶ bytes
3. æœ€åæŠŠ bytes åˆèµ·æ¥ï¼Œå¹¶ä¸”ç”¨æ­£ç¡®çš„ç¼–ç æ ¼å¼è§£ç å›æ­£ç¡®å­—ç¬¦ï¼Œ `b''.join(hex_bytes).decode('utf-8')` 

### I/O
ä¸»è¦åˆ†ä¸¤ç§ï¼šStringIOã€BytesIOï¼Œå‰è€…æ“ä½œ strï¼Œåè€…æ“ä½œäºŒè¿›åˆ¶

```python
import struct

# ç»“æ„åŒ–è¯»äºŒè¿›åˆ¶æ–‡ä»¶
label_file = open("Samples.bin", 'rb')  # æ ·æœ¬æ ¼å¼ä¸º215ä¸ªæµ®ç‚¹+1ä¸ªæ•´å‹ï¼Œä¸€å…±69ä¸ªæ ·æœ¬
label_raw = struct.unpack(69*'215fi', label_file.read(69*216*4))  # æ ¼å¼åŒ–è¯»å–ç›¸åº”å­—èŠ‚çš„ buffer
label_array = np.array(label_raw)
label_array = np.reshape(label_array, [69,-1])
label_file.close()
```

æƒ³è¦é€šè¿‡æ–‡ä»¶ I/O å†™æ•°æ®è¿›ç¡¬ç›˜éœ€è¦ç»è¿‡å‡ ä¸ªæ­¥éª¤ï¼Œå…¶ä¸­å­˜åœ¨å‡ ç§ç¼“å†²åŒºï¼š
1. å†…éƒ¨ç¼“å†²åŒºã€‚ç¨‹åºè°ƒç”¨ I/O æ¥å£ `file.write()` å†™å…¥æ—¶ä¼šå…ˆå†™åˆ°è¿è¡Œæ—¶/åº“/è¯­è¨€æ‰€åˆ›å»ºçš„å†…éƒ¨ç¼“å†²åŒºä¸­ä»¥åŠ å¿«ç¨‹åºå†™çš„é€Ÿåº¦ï¼Œå½“ç¼“å†²åŒºæ»¡äº†æ‰ä¼šç»è¿‡ç³»ç»Ÿè°ƒç”¨å†™å…¥åˆ°å®é™…æ–‡ä»¶ï¼ˆæ“ä½œç³»ç»Ÿç¼“å†²åŒºï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ `file.flush()` æ¥æ˜¾å¼è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œä½¿ç”¨ `with ... as` æ‰“å¼€çš„æ–‡ä»¶ä¼šè‡ªåŠ¨åš `flush`
2. æ“ä½œç³»ç»Ÿç¼“å†²åŒºã€‚å½“å®Œæˆäº†å†…éƒ¨ç¼“å†²åŒºåˆ°æ“ä½œç³»ç»Ÿç¼“å†²åŒºçš„å¤åˆ¶åï¼Œå…¶ä»–è¿›ç¨‹æ‰“å¼€æ–‡ä»¶å°±èƒ½è®¿é—®åˆ°æ›´æ–°çš„å†…å®¹ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰çœŸæ­£å†™åˆ°ç¡¬ç›˜ä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ `os.fsync(fd)` æ¥å¼ºåˆ¶å†™åˆ°ç¡¬ç›˜ä¸­ï¼Œä¸è¿‡ç°ä»£ç¡¬ç›˜å†…éƒ¨é€šå¸¸ä¹Ÿæœ‰å¤šçº§ç¼“å­˜åŒºï¼Œè€Œä¸”ä¸»åŠ¨çš„ `fsync` å¯èƒ½ä¼šè¢«ç¦ç”¨ä¹‹ç±»çš„ï¼Œæ‰€ä»¥å®é™…ä¼šæ›´å¤æ‚äº›
3. ä¸è¿‡å¥½åƒåœ¨ ext4 ä¸‹å¿…é¡»è¦ç»è¿‡ `fsync` æ‰èƒ½åŒæ­¥æ–‡ä»¶å†…å®¹ï¼Œæ›´å¤šå‚è€ƒ https://stackoverflow.com/questions/7127075/what-exactly-is-file-flush-doing


### ç‰ˆæœ¬æ§åˆ¶
```python
from packaging.version import Version, parse

v1 = parse("1.0a5")  # æ”¯æŒæ›´ä¸°å¯Œçš„éæ ‡å‡†æ ¼å¼
v2 = Version("1.0")
```

1. https://packaging.pypa.io/en/latest/version.html

### ç¯å¢ƒå˜é‡
- __PYTHONHOME__ï¼šè¡¨ç¤º python æ ‡å‡†åº“çš„å‰ç¼€è·¯å¾„ï¼Œé»˜è®¤ç³»ç»Ÿåº“ä¸º `/usr/`
  > Change the location of the standard Python libraries. By default, the libraries are searched in prefix/lib/pythonversion and exec_prefix/lib/pythonversion, where prefix and exec_prefix are installation-dependent directories, both defaulting to /usr/local.  
When PYTHONHOME is set to a single directory, its value replaces both prefix and exec_prefix. To specify different values for these, set PYTHONHOME to prefix:exec_prefix.
- __PYTHONPATH__ï¼špython æ¨¡å—ç´¢å¼•è·¯å¾„ï¼Œå¯ä»¥åœ¨ `sys.path` ä¸­æŸ¥çœ‹å’Œä¿®æ”¹ï¼Œæ·»åŠ ç´¢å¼•æ—¶å¸¸ç”¨çš„ç¯å¢ƒå˜é‡

å¦‚æœè¦åœ¨è„šæœ¬ä¸­ä¸´æ—¶æ’å…¥ç¯å¢ƒå˜é‡ï¼Œå¯é€‰æ‹© `os.environ['PYTHONPATH']='path'`ï¼Œå¦‚æœä¸å¥½ä½¿é‚£å°± `sys.path.insert(0, 'path')`

## è®¡ç®—
å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„è®¡ç®—æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘åˆ«çš„åº“ï¼Œæ¯”å¦‚ Taichi ä¹‹ç±»çš„

### å†…ç½®å‡½æ•°
- `vars(object)`ï¼šå‡½æ•°è¿”å›å¯¹è±¡ object çš„å±æ€§å’Œå±æ€§å€¼å­—å…¸
- `dir(object)`ï¼šè¿”å›å¯¹è±¡ object çš„æ‰€æœ‰å±æ€§åˆ—è¡¨

### å¸¸ç”¨ç”Ÿæˆå‡½æ•°
- `np.linspace(start, end, num_points)`ï¼šç”Ÿæˆ [start, end] çš„ num_points å¤§å°çš„æ•°ç»„

### ä¼ é€’
- `a = b`ï¼šå¯¹äº numpy æ•°ç»„ï¼Œæ­¤æ“ä½œåªæ”¹å˜æŒ‡é’ˆï¼Œa å’Œ b å…±ç”¨ä¸€å—å†…å­˜
- `a = b[0]`ï¼šæ³¨æ„ï¼Œå½“ b çš„å…ƒç´ æ˜¯åˆ—è¡¨å¯¹è±¡å…ƒç´ æ—¶ï¼ˆå¦‚ pytorch Tensorï¼‰ï¼Œå†…å­˜ä¸ä¼šæ‹·è´ï¼Œä¿®æ”¹ a ä¼šåŒæ—¶ä¿®æ”¹ b[0]
- `a = b.copy()`ï¼šå†…å­˜æ‹·è´
- `a = b[:,0:4]`ï¼šåˆ‡ç‰‡ä¼šæ‹·è´å†…å­˜ï¼Œä¸ä¼šä¿®æ”¹åŸæ•°ç»„

### çŸ©é˜µè®¡ç®—
- `a - b`ï¼šè¿™ç±»è¿ç®—æœ€å¥½åŒç»´åº¦ï¼Œä¸ç„¶å¯èƒ½ä¼šå‡ºç°æ„å¤–çš„ç»“æœ
- `a @ b`ï¼ŒçŸ©é˜µä¹˜æ³•ï¼ŒåŒ `np.dot(a,b)`ï¼Œä¸º Python3.5 æ–°æ·»åŠ çš„ç‰¹æ€§
- `np.einsum('ij,ik->jk',a,b)`ï¼šçˆ±å› æ–¯å¦æ±‚å’Œï¼Œé«˜çº§çš„çŸ©é˜µä¹˜æ³•è¡¨ç¤ºï¼Œ_"è¾“å…¥æ ‡è®°ä¸­é‡å¤å­—æ¯è¡¨ç¤ºæ²¿è¿™äº›è½´çš„å€¼å°†ç›¸ä¹˜"ï¼Œâ€œè¾“å‡ºæ ‡è®°ä¸­çœç•¥å­—æ¯è¡¨ç¤ºæ²¿è¯¥è½´çš„å€¼å°†è¢«æ±‚å’Œâ€_ã€‚å¦‚ä¾‹ï¼Œè¾“å…¥ç›¸åŒçš„ç»´åº¦ `i`ï¼ˆa å’Œ b çš„è¡Œç»´åº¦å„å…ƒç´ ï¼‰åš element-wise ä¹˜æ³•ï¼Œè¾“å‡ºè¡¨ç¤ºå–ä¸åŒçš„ç»´åº¦ `j` `k`ï¼ˆåˆ—ç»´åº¦ï¼‰åšéå†è®¡ç®—æ’åˆ—ï¼Œè€Œçœç•¥çš„ç»´åº¦è¡¨ç¤ºå¯¹ä¸Šè¿°ä¹˜æ³•ç»“æœæ±‚å’Œï¼Œè‹¥ i ä¸º 3ï¼Œ`[1,2,3]x[4,5,6] -> [4+10+18]`
  - `np.einsum('ij,ik->ijk',a,b)`ï¼šè¾“å‡ºä¸‰ç»´åº¦ï¼ŒåŒä¸Šæ²¿è¡Œç›¸ä¹˜ï¼Œè‹¥ i ä¸º 3ï¼Œ`[1,2,3]x[4,5,6] -> [[4],[10],[18]]`
  - åœ¨ Numpy ä¸‹ä¼šåŠ é€Ÿï¼Œä½†åœ¨å…¶ä»–ä¸€äº›åœºåˆï¼ˆPyTorchã€TensorFlowï¼‰ä¹‹ç±»çš„å¯èƒ½ä¼šå‡é€Ÿï¼Œæ‰€ä»¥åœ¨éé€šç”¨æ”¯æŒçš„çŸ©é˜µè®¡ç®—åœºåˆè¦è°¨æ…ä½¿ç”¨
- æ•°ç»„ç´¯ä¹˜ç§¯ï¼š`np.prod(a)`
- è¿”å›ä¸‰è§’æ–œè¾¹ï¼š`np.hypot(x1, x2)`ï¼Œ`x1` `x2` æ˜¯ä¸¤æ¡æ–œè§’è¾¹ï¼Œå¯ä»¥æ˜¯å¤šç»´çš„å¸¸æ•°
- çŸ©é˜µæ±‚é€†ï¼š`np.linalg.inv(x)`ï¼Œæ³¨æ„ï¼Œ`x` éœ€è¦æ˜¯ well-conditioned çš„ï¼Œä¹Ÿå°±æ˜¯ `np.linalg.cond(x)` éœ€è¦æ˜¯è¾ƒå°çš„æ•°ï¼Œä¸ç„¶çš„å¾—æ¥çš„å€¼å¯èƒ½ä¼šæœ‰ç›¸å½“å¤§çš„åå·®ï¼Œè¿™æ—¶å€™éœ€è¦ç”¨ä¼ªé€†æ¥æ›¿ä»£
- å¹¿æ’­æœºåˆ¶ï¼šä¸åŒç»´åº¦çš„çŸ©é˜µè¿›è¡Œè¿ç®—æ—¶çš„æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ˜¾å¼æ–¹æ³•å®Œæˆï¼Œæ˜¯ GPU è¿ç®—åŠ é€Ÿï¼ˆå‘é‡åŒ–ï¼‰çš„å¤´ç­‰ç›®æ ‡
    - `shape(2,3)-shape(2,1)`ï¼šä¼šè‡ªåŠ¨å¤åˆ¶æœ€åä¸€ç»´ï¼Œå˜æˆ `shape(2,3)-shape(2,3)`
    - `shape(2,1)-shape(1,2)`ï¼šä¼šåšè‡ªåŠ¨åˆ‡åˆ†éå†ï¼Œå¾—å‡º `shape(2,2)`

### æ‰¹é‡ç´¢å¼•
- `a[c,:]`ï¼šbool å€¼æ•°ç»„ `c = np.array([False, True, ...]), c.shape=(12,)` å¯ä»¥ä½œä¸º index ç­›é€‰å…¶ä»–æ•°ç»„ï¼Œæ­¤å¤„å¯ç­›é€‰å‡º a çš„ç¬¬ä¸€ç»´æ•°æ®
- `np.where(c)`ï¼šè¿”å› bool å€¼æ•°ç»„ä¸­ True çš„ç´¢å¼•ï¼Œå¸¸ç”¨å¦‚ `np.where((a>4)&(a<5))`ï¼Œå½“ c æ˜¯äºŒç»´æ•°ç»„æ—¶è¿”å› `(row_idxs, col_idxs)` çš„å…ƒç»„
- `np.isin(e1, e2)`ï¼šæ£€æµ‹ e1 ä¸­æ˜¯å¦æœ‰å«æœ‰ e2 ä¸­å…ƒç´ çš„å€¼ï¼Œè‹¥æ˜¯åˆ™ä¸º Trueï¼Œå¦åˆ™ Falseã€‚è¾“å‡º e1 å¤§å°çš„ arrayã€‚
- `a>0.5`ï¼šè¿”å›ç­‰å¤§å° bool å€¼çŸ©é˜µï¼Œè‹¥ `a[a>0.5]`ï¼Œåˆ™ç­›é€‰å‡ºç›¸åº”å€¼å¹¶ç»„æˆä¸€ç»´å‘é‡ï¼Œè‹¥ `a*(a>0.5)`ï¼Œåˆ™å¯ç½® a å°ç­‰äº 0.5 çš„å€¼ä¸º 0
- `a[a==255] = 0`ï¼šæ‰¹é‡æ›¿æ¢ 255 å€¼
- `img[vec1, vec2] = 255`ï¼šå¯ä»¥å‘é‡åŒ–ï¼Œ`vec1`ã€`vec2` ä¸ºä¸€ç»´æ•°ç»„
- `a[:,[2,0]]`ï¼šå– a æ•°ç»„ç¬¬äºŒç»´åº¦çš„ 2 å’Œ 0 é€šé“

### åˆ‡ç‰‡
- å†’å·`:`æ•°ç»„åˆ‡ç‰‡ï¼Œä¸çœç•¥ç»´åº¦ï¼Œå¦‚ï¼š
```python
a = np.arange(10)  
b = a[2:7:2]   # ä»ç´¢å¼• 2 å¼€å§‹åˆ°ç´¢å¼• 7 åœæ­¢ï¼Œé—´éš”ä¸º 2ï¼ˆnumpy é—´éš”å¯ä¸ºè´Ÿæ•°ï¼Œtorch ä¸å¯ï¼‰
# [start:stop:step]
# step å¯çœç•¥ï¼Œéµå¾ªå·¦é—­å³å¼€ [start, stop)
# start å’Œ stop ä¹Ÿå¯çœç•¥ï¼Œ
# è¡¨ç¤ºä¹‹åæˆ–ä¹‹å‰çš„å…¨éƒ¨ç´¢å¼• [start:] [:stop]

a = np.arange(12).reshape(4,3)
a = a[:,[2,1,0]]   # å®ç° BGR è½¬ RGBï¼ŒåŒ a[:,::-1]ï¼Œä½† torch åªæ”¯æŒè¯¥æ“ä½œ
```
- çœç•¥å·`...`ï¼šæ•°ç»„åˆ‡ç‰‡ï¼Œå¯çœç•¥å¤šä¸ªç»´åº¦ï¼Œæˆ–è€…ä¿æŒç»´åº¦ï¼Œå¦‚ï¼š
```python
a = np.random.rand(2,8,5,5)
print (a[...,1])   # axis 3 çš„ç¬¬ 2 ä¸ª [2,8,5]
print (a[1,...])   # axis 0 çš„ç¬¬ 2 ä¸ª [8,5,5]
print (a[...,1:])  # axis 3 çš„ç¬¬ 2 ä¸ªåŠä»¥å [2,8,5,4]
```

å†’å·åˆ‡ç‰‡å…¶å®æ˜¯é€šè¿‡ä¼  `slice(x1,x2,x3)` è¿› `__getitem__` æ¥å®ç°çš„ï¼Œå¯ä»¥æ£€æŸ¥å…¥å‚ç±»å‹æ¥åœ¨è‡ªå®šä¹‰ç±»ä¸­å®ç°åˆ‡ç‰‡

### ç‰¹æ®Šç´¢å¼•
- `np.searchsorted(array, value, side='right')`ï¼šå¯»æ‰¾å€¼çš„æ’å…¥åŒºé—´

### åˆ é™¤
- `list.remove(xxx)`
- `np.delete(a, [1], axis=1)`ï¼šåˆ é™¤ index=1 åˆ—

### é€»è¾‘
- åˆ¤ç©ºåƒä¸‡ä¸è¦ç”¨ `xxx is None`ï¼Œç©ºæ•°ç»„ä¹Ÿä¼šè¿”å› Falseï¼Œæœ€å¥½éƒ½ç”¨ `len()`ã€`.size` ç­‰æ–¹æ³•
- äº¤é›†å¹¶é›†ç­‰æ“ä½œé‡‡ç”¨ [[Python#é›†åˆ]]
- æ‰¹é‡é€»è¾‘åˆ¤æ–­å¯ä»¥ç”¨ `all([True, False, True]) == False` æˆ– `any([True, False, True]) == True` æ¥è¿›è¡Œï¼Œç±»ä¼¼å…¨éƒ¨ä¸æ“ä½œï¼ˆç©ºåˆ—è¡¨ä¹Ÿè¿”å› Trueï¼‰

### æ¯”è¾ƒ
- å¯ä»¥é‡‡ç”¨ `DeepDiff`ï¼Œèƒ½å¤Ÿåˆ—å‡ºåµŒå¥—ç»“æ„åŒ–æ•°æ®ä¹‹é—´çš„å·®å¼‚ï¼Œæ”¯æŒå¸¸ç”¨ç»“æ„å’Œ numpy æ•°ç»„ä½œä¸ºå…ƒç´ ï¼Œè¿˜æœ‰å¿½ç•¥å¤§å°å†™ã€å¿½ç•¥ç±»å‹å˜åŒ–ã€æŒ‡å®šæµ®ç‚¹ç²¾åº¦ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰åŠŸèƒ½ https://miguendes.me/the-best-way-to-compare-two-dictionaries-in-python

### æ‰©å¢
- `[1, 2, 3]*2 = [1, 2, 3, 1, 2, 3]` æˆ– `[2,3,4] + [23] = [2,3,4,23]`ã€‚__æ³¨æ„ï¼Œä¹˜æ³•æ‰©å¢ä¸ä¼šåœ¨å†…å­˜ä¸Šè¿›è¡Œæ‹·è´ï¼Œæ‰©å¢çš„éƒ¨åˆ†æ˜¯å…±äº«çš„__ 
- å…ƒç»„æ‰©å¢ä¹Ÿä¸€æ ·ï¼Œä¸è¿‡åªæœ‰ä¸€ä¸ªå…ƒç´ è¦å†™æˆ `(x, )` å½¢å¼
- å­—å…¸æ‰©å¢åˆ™ç›´æ¥èµ‹å€¼å°±å¥½ `a[new_key] = new_value`
- `np.insert(a, [2], 1, axis=-1)`ï¼šåœ¨æœ€åä¸€ç»´çš„ index=2 å‰é¢æ’å…¥å…¨ 1

### å †å /å±•å¼€
- PyTorch ä¸­æœ‰ `tile/unfold`ï¼Œè§æ­¤ [[PyTorch#^e3b3d9]]ï¼Œnumpy ä¸æ¸…æ¥š

### æ•°ç»„æ‰©ç»´åº¦
- `np.insert(a, 0, np.ones(9), axis=1)`ï¼šåœ¨ a æ•°ç»„çš„ç¬¬ 0 åˆ—__ä¹‹å‰__æ’å…¥ä¸€åˆ— 1ï¼Œ`a.shape=[9, 3]`ï¼Œç›¸å½“äº matlab çš„ [ones(9,1) a]
- `np.append(a, 1)`ï¼šå°† a å±•æˆä¸€ç»´ï¼Œå¹¶åœ¨æœ«å°¾æ’å…¥ 1ï¼Œå¤šç»´æƒ…å†µä¸æ˜
- `np.reshape(a, [a.shape[0], a.shape[1], -1])`ï¼šç±»ä¼¼ `torch.unsqueeze(-1)`
- `a[np.newaxis, :]`ï¼šç­‰åŒäº pytorch çš„ `a.unsqueeze(0)`ï¼Œtensorflow ä¸­ä¹Ÿæ˜¯ç±»ä¼¼æ–¹æ³•
- `np.repeat(a, 3, axis=-1)`ï¼šå°† a çš„æœ€åä¸€ç»´æ‰©å±•ä¸‰å€ï¼Œä¹Ÿå°±æ˜¯ [4,4,1] æ‰©å±•æˆ [4,4,3]

### é‡æ’
- `np.transpose(a, (1,2,0))`ï¼Œå¦å¤–æœ‰äº›åº“åªäº¤æ¢ä¸¤ä¸ªç»´åº¦ï¼Œæœ‰äº›åº“ä¼šç§°ä½œ `permute()`
- çŸ©é˜µå†…éƒ¨è®¾ç«‹å­çŸ©é˜µï¼ŒåŒæ—¶ä¸æ”¹å˜æ’åˆ—ç»“æ„ï¼š
  ```python
  # éœ€è¦è®¾ç½®åˆ†ç»„æƒ…å†µï¼Œå‡è®¾å†…éƒ¨å­çŸ©é˜µä¸º 4x4 å¤§å°ä¸€ç»„ï¼Œå³ block_shape = (4, 4)
  # ç”± a:(1380, 778) -> b:(345, 194, 4, 4)
  
  # strides ä¸ºæ¯ä¸ªç»´åº¦è·¨è¶Šåˆ°ä¸‹ä¸€ç»´åº¦çš„å­—èŠ‚å¤§å°ï¼Œæ³¨æ„è¦åŠ ä¸Šèˆå¼ƒçš„æœ«å°¾ä½™æ•°
  # å¦‚ b[0] -> b[1] éœ€è¦ç»å† 194x4x4+(778-194*4)*4ï¼Œä¹Ÿå°±æ˜¯ 778*4
  strides = 4 * np.array([a.shape[1] * block_shape[0], block_shape[1], a.shape[1], 1])
  
  # è¾“å‡º shape
  a_block_shape = (a.shape[0] // block_shape[0], a.shape[1] // block_shape[1],
                   block_shape[0], block_shape[1])

  # è¿™é‡Œè½¬æˆ 4 å­—èŠ‚çš„æµ®ç‚¹çŸ©é˜µå†åˆ‡åˆ†
  b = np.lib.stride_tricks.as_strided(a.astype(np.float32),
                                    a_block_shape, strides)
  ```

### åˆå¹¶
- numpyï¼š`np.concatenate( (a,b), axis=1 )`ï¼Œå°† a å’Œ b æ²¿ 1 ç»´åˆå¹¶ï¼Œæœ‰äº›åº“ç§°ä½œ `concat()` æˆ– `cat()`ï¼Œå¦‚æœè¦ concat åˆ°æ–°ç»´åº¦çš„è¯å°±æ˜¯ `np.stack()`
- listï¼š`clist = alist + blist`
- ä¸è¦æ±‚å®¹å™¨ç±»å‹ï¼š`itertools.chain(a, b)`ï¼Œåˆ›å»ºè¿­ä»£å™¨

### æ’å€¼
- `np.interp(np.linspace(1, 10, 50), np.linspace(1, 10, 10), a)`ï¼šç”¨äºä¸€ç»´çº¿æ€§æ’å€¼ï¼Œa æ˜¯å¤§å°ä¸º 10 çš„ä¸€ç»´æ•°ç»„
- `np.append()`ï¼šå±•æˆä¸€ç»´ï¼Œç„¶ååœ¨æœ«å°¾æ·»åŠ å€¼
- `scipy.interpolate.interpn(grid_cord, grid_val, inter_p)`ï¼šå¤šç»´æ’å€¼ï¼Œå…¶ä¸­ï¼š
    - `grid_cord`ï¼šç½‘æ ¼åœ¨å„ä¸ªç»´åº¦çš„åæ ‡çš„å…ƒç»„ï¼Œæ¯”å¦‚ `(np.array([1,2,3,4]), np.array([1,2]), np.array([1,2,3]))` å¯ä»¥ä»£è¡¨ä» x ç»´åº¦ä¸Šçœ‹å„ä¸ªç½‘æ ¼çš„åæ ‡åˆ»åº¦ä¸º 1,2,3,4ï¼ˆå¯ä»¥ä¸ç­‰é—´éš”ï¼Œç½‘æ ¼æœ€ç»ˆæ»¡è¶³é•¿æ–¹å½¢çŠ¶å°±è¡Œï¼‰ï¼Œå¦å¤–ä¸¤ä¸ªç»´åº¦åŒç†
    - `grid_val`ï¼šç½‘æ ¼å†…çš„å€¼ï¼Œå¦‚æœæŒ‰ä¸Šè¿°åæ ‡çš„è¯ï¼Œå…¶ shape åº”ä¸º [4, 2, 3]
    - `inter_p`ï¼šè¦æ’å€¼çš„ç‚¹ï¼Œshape ä¸º [N, 3]
    - https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interpn.html

### å–æ¨¡
- `a % b`ï¼ša æˆ– b å¯ä¸ºè´Ÿæ•°ï¼Œå…·ä½“ç»“æœï¼š
  ```python
  # ä»… python
  -17 % 10 = 3
  17 % -10 = -3
  -17 % -10 = -7
  ```

### å–æ•´
- `a // b`ï¼šæ³¨æ„ï¼Œå¦‚æœ a æ˜¯æµ®ç‚¹æ•°ï¼Œb æ˜¯æ•´å‹æ•°ï¼Œå–æ•´ç»“æœä¼šæ˜¯æµ®ç‚¹æ•°ï¼Œéœ€è¦è½¬æ¢ç±»å‹

### æˆªå–
- `np.clip(a, min, max)`ï¼šæœ‰äº›åº“ä¼šå« `clamp`

### éšæœº
- `random.shuffle(a)`ï¼šå¯¹ a è¿›è¡Œéšæœºæ‰“ä¹±ï¼Œinplace æ“ä½œ
- `random.sample(range(0, len(x)), 10)`ï¼šéšæœºé‡‡æ ·ï¼Œç”¨äºäº§ç”Ÿä¸é‡å¤éšæœºæ•°
    - `np.random.rand(d1,d2,d3)`ï¼šæ³¨æ„ï¼Œnumpy çš„éšæœºåœ¨å¤šè¿›ç¨‹ä¸­æ˜¯å„ä¸ªè¿›ç¨‹å¾—åˆ°ç›¸åŒå€¼çš„éšæœºï¼Œå¤šè¿›ç¨‹ä¸‹åº”å½“é‡‡ç”¨ `r = np.random.RandomState(random.randint(0, (1 << 32) - 1))` æ¥è·å¾—éšæœºç±»ï¼Œ`r.rand(d1,d2,d3)`

### æœ€å¤§æœ€å°ç´¢å¼•
- `np.argmax(a)` å’Œ `np.argmin(a)`
- `np.argsort()`ï¼šå¯ä»¥è¿”å›æœ€å°çš„å¤šä¸ªå…ƒç´ ç´¢å¼•

### æ’åº
Python ä½¿ç”¨ Timsort ç®—æ³•æ¥å®ç°ç¨³å®šæ’åºï¼Œç©ºé—´å¤æ‚åº¦ O(n)ï¼Œæ—¶é—´å¤æ‚åº¦æœ€å¥½ã€å¹³å‡ã€æœ€å·®åˆ†åˆ«ä¸º O(n), O(nlogn), O(nlogn)
- `sort()`ï¼šåº”ç”¨äº listï¼Œæ˜¯ inplace æ“ä½œ
- `sorted()`ï¼šå¯ç”¨äºæ‰€æœ‰å¯è¿­ä»£å¯¹è±¡ä¸Šï¼Œè¿”å›æ–° list

```python
# å…ˆå°†æ’åˆ—ä¾æ®è®¾ä¸º key å»ºç«‹å­—å…¸
a = {int(filestr):filestr for filestr in files}
# ç„¶åæ’åºï¼Œä¾æ¬¡å–å‡ºå€¼
b = [a[k] for k in sorted(a)]

# ä¹Ÿå¯ä»¥æŒ‰å€¼æ¥æ’åº
b = {k: v for k, v in sorted(a.items(), key=lambda item: item[1])}

# å¯ä»¥é€šè¿‡ key ä¼ å…¥æ’åºçš„ä¾æ®æå–å‡½æ•°
def sort_func(x):
    dot_stuff = x.split('.')
    slash_stuff = dot_stuff[-2].split('_')
    res = 6 - len(slash_stuff[-1])
    for i in range(res):
        slash_stuff[-1] = '0' + slash_stuff[-1]
    dot_stuff[-2] = '_'.join(slash_stuff)
    return '.'.join(dot_stuff)
sorted(a, key=sort_func)

# å°† xxx_1 xxx_10 xxx_2 æ’æˆ xxx_1 xxx_2 xxx_10
sorted(a, key=lambda x: int(get_base_name(x).split('_')[-1])

# å¦‚æœæ˜¯å­—å…¸æ’åºï¼Œåˆ™å¯ä»¥é€šè¿‡ items() åˆ†å¼€é”®å€¼
sorted(a.items(), key=lambda kv: kv[1])
```

### å­—ç¬¦ä¸²åŒ¹é…
- æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç›¸ä¼¼æ€§ï¼š`Levenshtein.distance(str1, str2)`ï¼Œç”¨äºå’Œå•è¯è¡¨åŒ¹é…å»é™¤ OCR è¯†åˆ«å™ªå£°

### è¯¯å·®
- `np.allclose(actual, desire, rtol, atol)`ï¼šæ¯”è¾ƒ `actual` å’Œ `desire` çš„å„æ•°å€¼å·®å¼‚ï¼Œç³»æ•°ç”¨äºç¼©æ”¾ï¼Œæ¯”è¾ƒçš„å®¹å¿åº¦ä¸ºï¼š`atol + rtol * abs(desire)`

### ç»Ÿè®¡
- `np.var()`ï¼šè®¡ç®—æ–¹å·®

### è§’åº¦ä¸­å¿ƒç‚¹ç”»æ—‹è½¬æ–¹å‘æ¡†
```python
cv2.rectangle(img_square, (int(tlx), int(tly)), (int(brx), int(bry)), (0, 0, 255), 2)
rot_mat = cv2.getRotationMatrix2D((int(x_center), int(y_center)), angle, 1.0)
img_rsquare = cv2.warpAffine(img_square, rot_mat, (img_square.shape[1], img_square.shape[0]))
img[np.sum(img_rsquare, 2)>0, :] = [0,0,0]
img = img + img_rsquare
 ```

### è½¬æ¢
- numpy è½¬ opencv
  - `b = np.uint8(a)`ï¼šè¦å¸¦ dtype çš„ numpy æ•°ç»„æ‰èƒ½è¢« opencv å¤„ç†ï¼Œæ­¤æ–¹æ³•ä¸ºå‘ä¸‹å–æ•´ï¼ˆæº¢å‡ºä¸æç¤ºï¼ŒæŒ‰å†…å­˜æ•°æ®å–å€¼ï¼‰
  - `b = cv2.copyTo(a, np.uint8(np.ones(a.shape)))`ï¼š python çš„ opencv æ•°ç»„å†…å­˜æ‹·è´
- numpy è½¬ list
  - `a = np.ones((12,12))`  
  - `b = a.tolist()`
  - `c = np.array(b)`
- è¾“å…¥è½¬å­—ç¬¦ä¸²ï¼š`a = str('xxxxx')`ï¼š`a = 'xxxxx'`
- è¾“å…¥è½¬åˆ—è¡¨ï¼š`b = list('xxx')`ï¼š`['x', 'x', 'x']`
- å­—ç¬¦ä¸²è½¬åˆ—è¡¨
  - `b = list(a)`
  - `b = a.split('\n')`ï¼šä»¥æ¢è¡Œç¬¦åˆ†å‰²å­—ç¬¦ä¸² aï¼Œç¼ºçœæ—¶ä»¥ç©ºç™½ç¬¦æ¥åˆ†å‰²ï¼ˆåŒ…æ‹¬ç©ºæ ¼æ¢è¡Œç¬¦ç­‰ï¼‰
- åˆ—è¡¨è½¬å­—ç¬¦ä¸²
  - `a = ''.join(b)`ï¼šåœ¨åˆ—è¡¨ b ä¸­æ’å…¥å­—ç¬¦ä¸²`''`æ¥æ„æˆå­—ç¬¦ä¸² a
- ç±»å‹è½¬æ¢
  - æ‰¹é‡ï¼š`list(map(int, a))`

### ç±»å‹æ£€æŸ¥
- `type(xxx)`ï¼šè¿”å›å¯¹è±¡ç±»å‹
- `isinstance(xxx, TYPE)`ï¼šæ£€æŸ¥å¯¹è±¡ç±»å‹ï¼Œ__å…¶ç±»å’ŒåŸºç±»è¢«è§†ä¸ºåŒä¸€ç±»__ï¼Œ`TYPE` å¯ä¸º `tuple` ä»¥æ£€æŸ¥æ˜¯å¦ç¬¦åˆå¤šç§ç±»å‹ä¹‹ä¸€


## å¸¸ç”¨æ•°æ®ç»“æ„ï¼ˆç±»ï¼‰
### æ–‡ä»¶
- åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•ï¼š`os.path.isfile()` `os.path.isdir()`ï¼Œç¬¦å·é“¾æ¥ä¹Ÿä¸€è§†åŒä»
- åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼š`os.path.exists(file_path)`
- è·å–ç›®å½•ä¸‹æ–‡ä»¶ï¼š
  - `glob.glob("xxx/*.png")`ï¼Œç»“æœå¸¦è·¯å¾„å‰ç¼€ï¼Œå¦‚ `xxx/1.png`ï¼Œä¸åŒ…æ‹¬éšè—æ–‡ä»¶
  - `os.listdir("xxx/")`ï¼Œç»“æœä¸å¸¦è·¯å¾„å‰ç¼€ï¼Œå¦‚ `1.txt`ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶
- è·å–è·¯å¾„ï¼š
  - å½“å‰å·¥ä½œç›®å½•ï¼š`os.getcwd()`ï¼Œç›¸å½“äº Shell é‡Œçš„ `pwd`ï¼Œæ³¨æ„ï¼Œå³ä½¿æ˜¯åœ¨å…¶ä»–è·¯å¾„ä¸‹çš„æ¨¡å—å†…éƒ¨ä½¿ç”¨è¿™ä¸ªè¿”å›çš„ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ `python xxx.py` æ—¶çš„ç›®å½•
  - å½“å‰æ–‡ä»¶ç›®å½•ï¼š`os.path.dirname(os.path.abspath(__file__))`ï¼ŒåŒæ ·çš„ï¼Œè·å–æŸä¸ªæ¨¡å—è·¯å¾„æ—¶å°±ä»¥ `module.__file__` æ›¿ä»£
  - è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼š`os.path.abspath(path)`

### æšä¸¾å˜é‡
`for (index, char) in enumerate(list(['a','b','c'])):`   
æšä¸¾è¿”å›çš„æ˜¯è®¡æ•°å€¼å’Œ list å†…å®¹çš„äºŒå…ƒç»„  
å¯¹äºå¯è¿­ä»£å¯¹è±¡ï¼Œå¯ç”¨ `next(X)` æ¥å¾—åˆ°ä¸‹ä¸€ä¸ªäºŒå…ƒç»„

- `zip(a, b)`ï¼šæ•°ç»„/å…ƒç»„åˆå¹¶ä¸ºæ•°å¯¹ï¼Œaã€b ä¸ºæ•°ç»„æˆ–å…ƒç»„ï¼Œlen ç›¸åŒï¼Œè¿”å›æšä¸¾å˜é‡ï¼Œå°† aã€b ä¸­çš„å€¼ä»¥å…ƒç»„å¯¹å½¢å¼é€ä¸ªè¾“å‡º

### åˆ—è¡¨
- åˆ¤æ–­ä¸ºç©ºï¼š`len(a)` æˆ–è€…ç›´æ¥ `if a:`
- æ£€æµ‹æ˜¯å¦æœ‰é‡åˆï¼š
  ```python
  from collections import Counter
  count_list = dict(Counter(a+b))
  print ({key:value for key,value in count_list.items()if value > 1})
  ```
- åˆ¤æ–­æ˜¯å¦åŒ…å«ï¼š`if 'xxx' in set(a):`
- åˆ—è¡¨å­—ç¬¦ä¸²è¿æ¥ä¼¼ä¹æ˜¯è‡ªåŠ¨çš„ï¼Ÿï¼š`['431' 'xzcvzv'] == ['431xzcvzv']`

### å…ƒç»„
ä¸åˆ—è¡¨ä¸åŒï¼Œå…ƒç»„ä¸èƒ½ç›´æ¥ä¿®æ”¹å…ƒç´ ï¼Œå±äºä¸å¯å˜ç±»å‹

è‡ªå®šä¹‰å‘½åå…ƒç»„ç»“æ„ï¼Œç±»ä¼¼è½»é‡åŒ–çš„ç±»ï¼š  
```python
from collections import namedtuple
gaussian = namedtuple('Gaussian', ['mean', 'var'])
# æ‰“å°æ˜¾ç¤ºæ ¼å¼
gaussian.__repr__ = lambda s: 'ğ’©(Î¼={:.3f}, ğœÂ²={:.3f})'.format(s[0], s[1])
```
ä½†æ˜¯ä¸èƒ½ç›´æ¥ `gaussian.mean=1` ä¿®æ”¹å±æ€§ï¼Œéœ€è¦é€šè¿‡ `gaussian._replace(mean=1)` æ¥ä¿®æ”¹  

è¿˜å¯ä»¥å°†å­—å…¸çš„ä¸‹æ ‡ç´¢å¼•è½¬ä¸ºè¿™ç§æŒ‡é’ˆç´¢å¼•ï¼š  
```python
TrialOptions = namedtuple('TrialOptions', dict_a.keys())
opt = TrialOptions(*dict_a.values())
```

### é›†åˆ
é›†åˆä¼¼ä¹æ˜¯ä¸€ç§å…ƒç´ å”¯ä¸€çš„åˆ—è¡¨ï¼Œä¸è€ƒè™‘é¡ºåºï¼Œå¯ä»¥ç”¨äºå„ç§å–äº¤é›†å¹¶é›†çš„åœºåˆ
```python
set([1,2,3,3,4,4,4,4])
# output: {1,2,3,4}
```


### å­—å…¸
Python çš„å­—å…¸æ˜¯å“ˆå¸Œè¡¨çš„å®ç°ï¼Œå­—å…¸çš„é”®éœ€è¦æ˜¯ä¸å¯å˜ç±»å‹ï¼ˆå¸¸é‡ã€å…ƒç»„æˆ–å¯¹è±¡éƒ½è¡Œï¼‰ï¼Œè€Œä¸èƒ½æ˜¯å¯å˜ç±»å‹ï¼ˆåˆ—è¡¨ã€æ•°ç»„ç­‰ï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œå…¶å“ˆå¸Œå‡½æ•°çš„å¤„ç†å¦‚ä¸‹ï¼š
- æ•´æ•°å’Œå¸ƒå°”å€¼é‡‡ç”¨åŸå€¼
- å…ƒç»„ä½¿ç”¨å„å…ƒç´ å“ˆå¸Œå€¼çš„ç›¸åŠ 
- å¯¹è±¡ä½¿ç”¨å†…å­˜åœ°å€

å†²çªå¤„ç†é‡‡ç”¨å¼€æ”¾å¯»å€çš„ä¼ªéšæœºæ³•ã€‚

ä½¿ç”¨è®°å½•ï¼š
- åˆ¤æ–­å­—å…¸æ˜¯å¦å«æœ‰è¯¥é”®å€¼ï¼š`dict.__contains__('name')`
- å½“å­˜åœ¨æ—¶è¿”å›é»˜è®¤å€¼å¯ç”¨ï¼š`dict.get('name', None)`ï¼Œç¬¬äºŒé¡¹ä¸º default é¡¹ï¼Œä¸èƒ½ç”¨é”®å€¼æ–¹å¼è¾“å…¥ `default=xxx`ï¼Œå› ä¸ºè¿™ç§å†…ç½®å‡½æ•°å¤šæ•°æ˜¯ C å±‚ API åªèƒ½ç”¨ä½ç½®æ¥ç¡®å®šå‚æ•°
- æ’åºï¼š`sorted(a)` å¾—åˆ° key çš„æ’åºåçš„ listï¼Œè§ [[Python#Python#è®¡ç®—#æ’åº|æ’åº]]
- æ¯”è¾ƒï¼šå­—å…¸ key ç†è®ºä¸Šæ˜¯ä¸è®²é¡ºåºçš„ï¼Œ`a == dict(sorted(a.items(), key=lambda x:x[0]))`
- è¿”å›é”®å€¼ï¼š`dict.values()`ï¼Œè¿”å›çš„æ˜¯ dict_values ç±»å‹æ•°ç»„ï¼Œä½¿ç”¨ `list(dict.values())` è½¬æ¢ä¸ºåˆ—è¡¨æ‰å¯ä»¥ç´¢å¼•ä½¿ç”¨
- æ›´æ–°å­—å…¸é‡Œå¯¹åº”çš„å€¼ï¼š`x2.update(x1)`ï¼Œæœ‰åˆ™æ›¿æ¢ï¼Œæ— åˆ™æ’å…¥
- åˆ é™¤ï¼š`del dict['name']`
- å­—å…¸åè½¬ï¼š`{value : key for (key, value) in a.items()}`
- ç‰¹æ®Šå­—å…¸
	- å¦‚æœéœ€è¦åœ¨éå†æ—¶æŒ‰æ’å…¥é¡ºåºéå†ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `collections.OrderedDict` ä»£æ›¿ï¼ˆpython 3.6 ä»¥ä¸Šéƒ½æ˜¯é»˜è®¤è®°å½•äº†æ’å…¥é¡ºåºçš„ï¼‰
	- å¦‚æœéœ€è¦è®©å­—å…¸è‡ªåŠ¨åˆå§‹åŒ–å€¼ä¸º listï¼Œä¸ä¼š append ç©ºé”®å€¼å‡ºé”™ï¼Œå¯ä»¥ä½¿ç”¨ `defaultdict(list)` æ¥ä»£æ›¿

### å¯¹è±¡
- `vars(xxx)`ï¼šè¿”å›å¯¹è±¡çš„å±æ€§å’Œå¯¹åº”å€¼çš„å­—å…¸ï¼Œè‹¥æ— å…¥å‚åˆ™åŒ `locals()` è¿”å›å½“å‰ä½ç½®çš„å±æ€§å’Œå¯¹åº”å€¼ã€‚


### æ—¶é—´
- ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨å¹³å°é»˜è®¤çš„è®¡æ—¶ï¼Œè¿”å›ç§’
  ```python
  from timeit import default_timer as timer
  start = timer()
  end = timer()
  print(end-start, ' s')
  ```
- å­˜åœ¨å¤šä¸ªè®¾å¤‡ï¼ˆGPU ä¹Ÿç®—ï¼‰åŒæ—¶è¿ä½œæ—¶æµ‹æ—¶é—´ï¼Œéœ€è¦ä¸€äº›åŒæ­¥çš„æ–¹æ³•å’Œå¹³å°æ— å…³çš„æ—¶é—´æµ‹é‡ï¼Œå¦‚ `torch.cuda.synchronize()`
- è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼š
    ```python
    timestamp = os.path.getmtime(f)
    struct_time = time.localtime(timestamp)
    time.strftime('%Y-%m-%d %H:%M:%S', struct_time)
    ```

## è®¾è®¡æ¨¡å¼

### åˆ›å»ºå‹æ¨¡å¼
ç”¨äºç”Ÿæˆç‰¹å®šè¡Œä¸ºçš„å¯¹è±¡çš„æ¨¡å¼ã€‚ä¸»è¦æ˜¯å·¥å‚ï¼Œå…¶ä»–è¿˜åŒ…æ‹¬å•ä¾‹æ¨¡å¼

### ç»“æ„å‹æ¨¡å¼
ç”¨äºç‰¹å®šä½¿ç”¨åœºæ™¯çš„ä»£ç ç»“æ„æ¨¡å¼

æœ€è‘—åçš„æ˜¯ ZCAï¼ˆZope Component Architectureï¼‰ï¼Œä¸»è¦æä¾›ç”¨äºå®šä¹‰ã€æ³¨å†Œã€æŸ¥æ‰¾ç»„ä»¶çš„å·¥å…·ï¼ŒåŒ…æ‹¬ä¸¤ç±»ç»„ä»¶ï¼šAdaptersã€Utilities

é€‚é…å™¨ï¼ˆAdapterï¼‰ï¼šå°è£…ä¸€ä¸ªç±»æˆ–å¯¹è±¡ Aï¼Œç”¨äºå·¥ä½œåœ¨ä¸€ä¸ªç±»æˆ–å¯¹è±¡ B çš„ä¸Šä¸‹æ–‡ä¸­

### è¡Œä¸ºå‹æ¨¡å¼
å¯¹è¿‡ç¨‹è¿›è¡Œç»“æ„åŒ–çš„æ¨¡å¼


## ç¤ºä¾‹
### å¹¶è¡Œ I/O
å‰é¢æåˆ°ä½¿ç”¨ `multiprocessing` å¯ä»¥å®Œæˆå¹¶è¡Œå¤„ç† [[Python#å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹]]ï¼Œå…¶ä¸­ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯å¹¶è¡Œ I/Oã€‚æ¯”å¦‚åˆ©ç”¨å¤šæ ¸ CPU è¿›è¡Œå¿«é€Ÿæ–‡ä»¶ç§»åŠ¨ï¼š

```python
import os
import shutil
from multiprocessing import Pool
from typing import List

def copy_file(src_file: str, dst_directory: str):
    if not os.path.exists(dst_directory):
        os.makedirs(dst_directory, exist_ok=True)
    try:
        # copy2 ä¼šå°è¯•ä¿ç•™å…ƒä¿¡æ¯ï¼Œfollow_symlinks=False ä¼šå¤åˆ¶ç¬¦å·é“¾æ¥è€Œä¸æ˜¯å¤åˆ¶åŸæœ¬
        shutil.copy2(src_file, dst_directory, follow_symlinks=False)
    except:
        # å¦‚æœæ–‡ä»¶å·²å­˜åœ¨åˆ™è·³è¿‡
        pass

def copy_files_in_folder(src_folder: str, dst_folder: str, exclude: List[str]):
    # followlinks=True ä¼šéå†ç¬¦å·é“¾æ¥æ–‡ä»¶å¤¹
    for root, dirs, files in os.walk(src_folder, followlinks=True):
        if any(ex in root for ex in exclude):
            continue
        relative_path = os.path.relpath(root, src_folder)
        dst_directory = os.path.join(dst_folder, relative_path)
        # å•ç‹¬å¤„ç†ç¬¦å·é“¾æ¥æ–‡ä»¶å¤¹
        if os.path.islink(root):
            dst_directory = '/'.join(dst_directory.split('/')[:-1])
            copy_file(root, dst_directory)
        else:
            # å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡
            _ = [pool.apply_async(copy_file, args=(os.path.join(root, f), dst_directory)) for f in files if f not in exclude]

pool = Pool(N)
exclude = ['.ipynb_checkpoints', '__pycache__']
copy_files_in_folder(src_folder, dst_folder, exclude)
pool.close()
pool.join()
```

å†æ¯”å¦‚ï¼Œå¿«é€Ÿæ¸…ç† ipy ç¼“å­˜
```python
exclude = set(['.ipynb_checkpoints', '__pycache__'])

def worker(path):
    for root, dirs, files in os.walk(path, followlinks=True):
        if any(ex in root for ex in exclude):
            return root
    return None

src_folder = opt.src
dirs = [d for d in os.listdir(src_folder) if os.path.isdir(os.path.join(src_folder, d))]
with mp.Pool(15) as pool:
    results = pool.map(worker, dirs)

result = [r for r in results if r]
print(result)
[shutil.move(path, '/somwhere/ipy_check/'+str(i)+'_'+'_'.join(path.split('/')[1:-1])) for i, path in enumerate(result)]
```

å…³é”®åœ¨äºä½¿ç”¨è¿›ç¨‹æ± æ¥å¼‚æ­¥å¤„ç†æ¯ä¸ªæ“ä½œï¼Œéœ€è¦ç¡®ä¿æ¯ä¸ªè¿›ç¨‹çš„æ“ä½œæ˜¯ç‹¬ç«‹çš„


## åº“
### collections
åŒ…å«å¾ˆå¤šæœ‰ç”¨çš„æ•°æ®ç»“æ„
```python
## Counter: é¢‘ç‡ç»Ÿè®¡ç›¸å…³ç±»ï¼Œå­—å…¸çš„å­ç±»
a = 'eabcdabcdabcaba'
# ç±»ä¼¼å­—å…¸
c = collections.Counter(a)  # {'e': 1, 'a': 5, 'b': 4, 'c': 3, 'd': 2}
# æä¾›å‰ n ä¸ªé«˜é¢‘å‡ºç°çš„å…ƒç´ 
c.most_common(3)  # [('a', 5), ('b', 4), ('c', 3)]

```

### Numpy
- å…¨å±€ç²¾åº¦è®¾ç½®ï¼š`np.set_printoptions(precision=8)`  
- ç¼©ç•¥æ‰“å°è¾“å‡ºé™åˆ¶ï¼š`np.set_printoptions(threshold=10000, linewidth=200)`
- ä¸ä»¥ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤ºè¾“å‡ºï¼š`np.set_printoptions(suppress=True)`ï¼Œpytorch ä¹Ÿæ˜¯ç±»ä¼¼ `torch.set_printoptions(sci_mode=False)`
- ä¿å­˜æˆ `.mat` åœ¨ matlab åˆ†æï¼š`scipy.io.savemat('PR_curve.mat', {'precision': precisionC, 'recall': recallC, 'threshold': thresholdC})`
- ä¸åŒç±»å‹æ•°ç»„é—´è¿›è¡Œ "=" èµ‹å€¼æ—¶ï¼Œå¦‚ `a[:,:,0] = b`ï¼Œä¼šå°† b çš„å€¼ç›´æ¥å†…å­˜ç´¢å¼•ç»™ aï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰ç±»å‹è½¬æ¢ï¼Œå¯èƒ½ä¼šæº¢å‡ºã€‚

### Matplotlib
åœ¨ notebook ä¸­ä½¿ç”¨æ—¶åŠ¡å¿…åŠ ä¸Š `%matplotlib notebook` æ¥å¯ç”¨å†…è”äº¤äº’ï¼Œä¸ç„¶ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜  
- å•é€šé“å›¾ç‰‡æ˜¾ç¤ºéœ€è¦è®¾ç½®ä¸º `plt.show(img, cmap='gray', vmin=0, vmax=255)`ï¼Œå¦åˆ™ä¼šæ˜¾ç¤ºä¸€ç‰‡é»‘

```python
# åŸºæœ¬ xy
import matplotlib.pyplot as plt

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.family'] = ['WenQuanYi Micro Hei']
plt.rcParams['font.size'] = 15


plt.plot(x, y, '-')
plt.show()

# å¤šæ›²çº¿æ·»åŠ æ ‡è®°
plt.legend(['a', 'b'])
# æ‰“å¼€ç½‘æ ¼
plt.grid('on')
# è®¾ç½® y è½´é—´éš”
px = plt.yticks(np.arange(0, np.max(a)+0.01, 0.01))

# ç›´æ–¹å›¾
plt.hist(data, bins=40, facecolor="blue", edgecolor="black", alpha=0.7)

# é¥¼çŠ¶å›¾
for i in range(4):
    data_count.append(num)
    labels.append(lab)
colors = sns.color_palette('bright')
plt.pie(data_count, labels=labels, colors=colors, autopct='%0.0f%%')

# å›¾åƒ
plt.imshow(array)

# å»æ‰ç©ºç™½é—´éš”
plt.subplots_adjust(hspace=0, wspace=0)
# plt.gca().set_axis_off()
# plt.subplots_adjust(top = 1, bottom = 0, right = 1, left = 0, 
#                     hspace = 0, wspace = 0)
# plt.margins(0,0)
# plt.gca().xaxis.set_major_locator(plt.NullLocator())
# plt.gca().yaxis.set_major_locator(plt.NullLocator())

# ä¸æ˜¾ç¤º x åæ ‡è½´åˆ»åº¦
plt.xticks([])

# ä¾‹
plt.figure(figsize=(8, 8))
plt.subplot(1, 2, 1)
plt.imshow(img)
plt.subplot(1, 2, 2)
# è‡ªåŠ¨ç¼©æ”¾å€¼åŸŸ
plt.imshow(tf.keras.preprocessing.image.array_to_img(out[0]))
plt.axis('off')	
# ä¿å­˜å›¾åƒï¼Œä¸ pad å‘¨å›´
plt.savefig("res.png", bbox_inches='tight', pad_inches=0.0)
plt.show()


# äº¤äº’æ˜¾ç¤º
import matplotlib.style as mplstyle
mplstyle.use('fast')
fig = plt.figure(figsize=[9,9], tight_layout={'pad':0.0})
ax = fig.add_subplot(1,1,1)
im = ax.imshow(np.random.randn(10,10))
ax.axis('off')
def disp(img):
    im.set_data(img)
    fig.canvas.draw_idle()


# ä¸‰ç»´æ›²é¢
img = np.zeros((256,256))
xx = np.arange(0,256,1)
yy = np.arange(0,256,1)
X, Y = np.meshgrid(xx, yy)
fig = plt.figure()  #å®šä¹‰æ–°çš„ä¸‰ç»´åæ ‡è½´
ax3 = plt.axes(projection='3d')
ax3.plot_surface(X,Y,img,cmap='rainbow')
# ax3.contour(X,Y,img,offset=1, cmap='rainbow')   #ç­‰é«˜çº¿å›¾ï¼Œè¦è®¾ç½®offsetï¼Œä¸ºZçš„æœ€å°å€¼
plt.show()

# å¸¦ç±»åˆ«é¢œè‰²çš„æ•£ç‚¹å›¾
plt.scatter(data[:,0], data[:,1], c=colors)  # color ä¸º 0-1, RGB [n,3] æˆ– [1,3]
```
é—®é¢˜ï¼š
- `UserWarning: Glyph 25151 (\N{CJK UNIFIED IDEOGRAPH-623F}) missing from current font`ï¼šä¸­æ–‡ä¸èƒ½æ­£ç¡®æ˜¾ç¤ºï¼Œé€šè¿‡æ‰¾ä¸­æ–‡å­—ä½“ `fc-list :lang=zh family`ï¼Œç„¶åè®¾ç½® `plt.rcParams['font.family'] = ['ä¸­æ–‡å­—ä½“', 'sans-serif']` æ›¿æ¢å°±è¡Œ
- `Font family ['Noto Sans CJK'] not found`ï¼š æ¥ä¸Šæ–‡ï¼Œåˆ™ `sudo apt install msttcorefonts -qq` + `rm ~/.cache/matplotlib -rf`ï¼Œç„¶åä½¿ç”¨å¦‚ `plt.rcParams['font.family'] = ['WenQuanYi Micro Hei']`

### seaborn
matplotlib ä¸Šå±‚åº“
```python
# è®¾ç½®ä¸»é¢˜ä»¥åŠä¸­æ–‡å­—ä½“ã€å¤§å°
sns.set_theme(style="whitegrid", font_scale=1.4, rc={"font.family": "WenQuanYi Micro Hei"})


# å–ä¸¤ä¸ªå±æ€§è¿›è¡Œç”»å›¾ï¼Œx ä¸ºç¦»æ•£å±æ€§ï¼Œy ä¸ºè¿ç»­å±æ€§
#                     hue ä¸ºç¦»æ•£å±æ€§ï¼ˆç”¨äºæˆå¯¹æ˜¾ç¤ºï¼‰
# æ”¹ä¸º boxenplot å¯ä»¥ç”»å‡ºå¢å¼ºç‰ˆç®±çº¿å›¾
ax = sns.boxplot(x="method", y="lpips", hue="param", data=scores_df)

# åŠé€æ˜åŒ–
plt.figure(figsize=(10,8))
ax = sns.boxplot(x="tuned", y="lpips", data=scores_df, saturation=.9)
for patch in ax.artists:
    r, g, b, a = patch.get_facecolor()
    patch.set_facecolor((r, g, b, .5))
    
# è°ƒæ•´ y è½´
px = plt.yticks(np.arange(0, scores_df['lpips'].max()+0.01, 0.01))

# ç”»æ•£ç‚¹å›¾
ax = sns.stripplot(x="epoch", y="lpips", data=scores_df, jitter=0.1)

# ç”»ç±»å‹å›¾ï¼Œé€šè¿‡ height å’Œ aspect æ¥è°ƒæ•´ç”»å¸ƒå¤§å°
# attr_data ä¸ºæ‹¥æœ‰ attr value bk ä¸‰ä¸ªç»´åº¦å±æ€§çš„ DataFrame 
g = sns.catplot(
    data=attr_data, kind="bar",
    x="attr", y="value", hue="bk", palette="dark", alpha=.6, height=10, aspect=20/10
)
# å»æ‰å·¦è¾¹è½´çº¿
g.despine(left=True)
g.set_axis_labels("", "value")
g.legend.set_title("")
```
é—®é¢˜ï¼š
- `missing from current font`ï¼šé—®é¢˜åŒ matplotlib éœ€è¦ `sns.set_theme(rc={"font.family": "WenQuanYi Micro Hei"})`


### jupyter
notebook ä¸­å¤šè¿›ç¨‹ç¤ºèŒƒï¼ˆä½†ä¼¼ä¹ä¸å¤ªå¯é ï¼‰ï¼š
```python
from multiprocessing.pool import ThreadPool as Pool

sites = [
    'https://github.com/veit/jupyter-tutorial/',
    'https://jupyter-tutorial.readthedocs.io/en/latest/',
    'https://github.com/veit/pyviz-tutorial/',
    'https://pyviz-tutorial.readthedocs.io/de/latest/',
    'https://cusy.io/en',
]

def func(url):
    return url

pool = Pool(4)
for result in pool.imap_unordered(func, sites):
    print(result)
```

- ä½¿ç”¨ virtualenvï¼š  
  å®‰è£… `pip3 install ipykernel`  
  `python3 -m ipykernel install --user --name=xxx`
- åˆ é™¤ kernelï¼š  
  `jupyter kernelspec remove`
- æŸ¥çœ‹ kernelï¼š  
  `jupyter kernelspec list`
- ä½¿ç”¨ parser é»˜è®¤é…ç½®ï¼š  
  `parser.parse_args(args=[])`
- Undo & Redoï¼š  
  Esc ä¸‹ `z` & `Shift+z`
- è·¨æ–‡ä»¶å¤åˆ¶ï¼šcommand mode ä¸‹å¤åˆ¶ cellï¼Œç„¶åå¦ä¸€ä¸ªæ–‡ä»¶è¿æŒ‰ä¸¤æ¬¡ ctrl+v
- ä¿®æ”¹å­—ä½“ï¼šåœ¨ `~/.jupyter/custom/custom.css` å†…æ·»åŠ  
  ```css
  .CodeMirror {
    font-family: Dejavu Sans Mono;
    font-size: 14px !important;
  }
  ```
- å¢åŠ  notebook å®½åº¦ï¼š
  ```python
  from IPython.core.display import display, HTML
  display(HTML("<style>.container { width:100% !important; }</style>"))
  ```
- è‡ªåŠ¨é‡æ–°åŠ è½½æ¨¡å—ï¼ˆä¸é‡å¯å°±èƒ½è°ƒè¯•æ¨¡å—ï¼Œé™¤æ”¹å˜ç±»ç»“æ„ï¼ˆå¦‚ç»§æ‰¿ï¼‰å¤–ï¼‰ï¼š
  ```python
  %load_ext autoreload
  %autoreload 2
  ```
- ä¸è¾“å‡º Outputï¼š
  `%%capture`
- æ›´å¤šæŒ‡ä»¤è§ï¼š https://ipython.readthedocs.io/en/stable/interactive/magics.html
- é—®é¢˜ï¼š
  - Tab å¤±æ•ˆï¼Œè€Œ Shift + Tab æœ‰æ•ˆï¼š`pip install jedi==0.17.2`
  - è‡ªåŠ¨è¡¥å…¨å¾ˆæ…¢ï¼šJedi çš„é—®é¢˜ï¼š`%config IPCompleter.use_jedi = False` ç¦ç”¨ Jedi
      - https://github.com/ipython/ipython/issues/10493
  - `pip install -e .` å®‰è£…çš„åº“ jupyter ç”¨ä¸äº†ï¼šå®‰è£…åˆ°äº† `/usr/lib/python3.9/site-packages/` ä¸­å¯¼è‡´ï¼Œç§»åˆ° `/usr/local/lib/python3.9/dist-packages/` ä¸‹å°±è¡Œ
  - `LD_LIBRARY_PATH` å’Œç»ˆç«¯ä¸åŒï¼Ÿ è§ [[Python#å‘]] 13.
  

### logging
```python
import logging

# è¾“å‡ºåˆ°æ–‡ä»¶
# logging.basicConfig(filename='logger.log', level=logging.INFO)

# è¾“å‡ºåˆ°ç»ˆç«¯
logger = logging.getLogger('fasion_mnist_AutoML')
logger.setLevel(logging.INFO)
logger.info('\nTest set: Average loss: {:.4f}, Accuracy: {}/{} ({:.0f}%)\n'.format(
        test_loss, correct, len(test_loader.dataset), accuracy))
```

### argparse
```python
parser = argparse.ArgumentParser(description='GAN Research')
parser.add_argument(
    "--config",
    default="",
    metavar="FILE",
    help="path to config file",
    type=str,
)
parser.add_argument('--log_step', default=10, type=int, help='Print logs every log_step')
parser.add_argument('--use_tensorboard', default=True, type=str2bool)
parser.add_argument(
    "opts",    # positional argument
    help="Modify config options using the command-line",
    default=None,
    nargs=argparse.REMAINDER,
)
args = parser.parse_args()
```
1. æœ€åä¸€ä¸ªå‚æ•°ï¼Œæ¥å—æœªæ˜ç¡®æŒ‡æ˜çš„ä»»æ„ç±»å‹å€¼ï¼Œç”¨ç©ºæ ¼åˆ†éš”  
2. å¦‚æœæ˜¯åœ¨ notebook ä¸­ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ä¼ å…¥ç©ºå‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼Œ`parser.parse_args(args=[])`ï¼Œå¦‚æœè¦è§£æå‘½ä»¤è¡Œå­—ç¬¦ä¸²åˆ™å¯ä»¥ `parser.parse_known_args(args_string.split(' '))`
3. ä½¿ç”¨ `nargs` å‚æ•°å¯ä»¥è°ƒæ•´é€‰é¡¹æ‰€éœ€çš„å‚æ•°ä¸ªæ•°ï¼š
  - `parser.add_argument(, nargs="?",)`ï¼š`?` è¡¨æ˜æŒ‡å®šé€‰é¡¹æ—¶å¯ä»¥é™„å¸¦ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥åªæŒ‡å®šé€‰é¡¹ä¸å¸¦å‚æ•°ï¼ˆä½¿ç”¨ `const` å€¼ï¼‰ï¼Œæˆ–è€…éƒ½ä¸æŒ‡å®šï¼ˆä½¿ç”¨ `default` å€¼ï¼‰
  - `parser.add_argument(, nargs="+",)`ï¼š`+` å’Œ `*` ç±»ä¼¼ï¼Œéƒ½ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…è§„åˆ™ï¼Œåœ¨æŒ‡å®šé€‰é¡¹éœ€è¦å¤šä¸ªå‚æ•°æ—¶å¯ä»¥ç”¨ï¼ŒæŒ‡å®šå…¶ä»–é€‰é¡¹æ—¶ç»ˆæ­¢å‚æ•°åŒ¹é…ã€‚__å…¶è§£æåç±»å‹å˜ä¸º listï¼Œå…ƒç´ æ˜¯æŒ‡å®šçš„ typeï¼Œæ‰€ä»¥ä¸éœ€è¦ `type=list`__
4. ä½¿ç”¨ `argparse.ArgumentParser(prog='PROG')` å…è®¸åªè¾“å…¥é€‰é¡¹çš„å‰ç¼€ï¼ˆéœ€å”¯ä¸€ï¼‰
5. å¯¹äºå¯èƒ½æœ‰é¢å¤–æœªè¯†åˆ«çš„é€‰é¡¹å’Œå‚æ•°è¾“å…¥æ—¶ï¼Œä½¿ç”¨ `parser.parse_known_args()` æ¥ä»£æ›¿ `parser.parse_args()` å¯ä»¥å°†å®ƒä»¬å­˜åˆ°é¢å¤–çš„ä¸€ä¸ª list é‡Œ `args, unkown_list = parser.parse_known_args()`

å¯¹äºæƒ³è¾“å…¥ bool ç±»å‹çš„æƒ…å†µï¼Œéœ€è¦æ‰‹å†™ string è½¬ boolï¼š
```Python
# bool ç±»å‹è¾“å…¥éœ€è¦åšå­—ç¬¦è½¬æ¢å¤„ç†
def str2bool(v):
    if v.lower() in ('yes', 'true', 't', 'y', '1'):
        return True
    elif v.lower() in ('no', 'false', 'f', 'n', '0'):
        return False
    else:
        raise argparse.ArgumentTypeError('Unsupported value encountered.')

parser.add_argument('--use_dropout', type=str2bool, nargs='?', const=True, default=False, help='use dropout for the generator')
```
è¿™æ ·å°±èƒ½ä½¿ç”¨ `--use_dropout`ã€`--use_dropout True` æ¥è¡¨ç¤º Tureï¼Œ`--use_dropout False` æˆ–è€…å¹²è„†ä¸æŒ‡æ˜æ¥è¡¨ç¤º False


### ipywidgets
è‹¥æ— æ³•æ˜¾ç¤ºåˆ™åŠ  `%matplotlib inline`ï¼Œè¿˜ä¸è¡Œåˆ™ `pip install --upgrade --force-reinstall ipywidgets`ã€`pip install --upgrade --force-reinstall widgetsnbextension`ã€`jupyter nbextension enable --py widgetsnbextension --sys-prefix`

### tqdm
è¿›åº¦æ¡æ’ä»¶
```python
from tqdm import tqdm
for idx, image in tqdm(enumerate(input_iter), total=num_files):
	pass

# è®­ç»ƒæ˜¾ç¤º
for epoch in range(1, 2):
    with tqdm(range(100), unit="batch") as tepoch:
        for iters in tepoch:
            tepoch.set_description(f"Epoch {epoch}")
            optimizer_D.zero_grad()
            y = model(x)
            loss = loss_func(y, x)
            loss.backward()
            optimizer_D.step()
            tepoch.set_postfix(loss=loss.item())
```

### Requests
```python
# è¯·æ±‚å›¾ç‰‡
res = requests.get(url)
with open('./xx.png', 'wb') as f:
    f.write(res.content)
```

### JSON
ä»¥å­—å…¸å½¢å¼å­˜å‚¨ï¼Œå¦‚ `{"id": "str"}`ï¼Œå¦‚æœè¦ä¿å­˜æ•°ç»„ï¼ˆåªæ”¯æŒä¸€ç»´ï¼‰çš„è¯åˆ™å¦‚ `{"id": [num1, num2, num3]}`
- `json.dumps(a, indent=2)`ï¼šå°†å­—å…¸è½¬æˆ JSON å­—ç¬¦ä¸²ï¼Œç¼©è¿›ä¸¤æ ¼
- `json.dump(a, f, indent=2)`ï¼šåœ¨ I/O ä¸Šä¸‹æ–‡ä¸­å°†å­—å…¸è¾“å‡º
- å¦‚æœå«æœ‰ä¸­æ–‡å­—ä½“ï¼Œåˆ™éœ€è¦å–æ¶ˆé»˜è®¤çš„ ASCII ç¼–ç ï¼ŒæŒ‡å®š `ensure_ascii=False`


### Joblib
é’ˆå¯¹å¤§æ•°æ® numpy æ•°ç»„è¿›è¡Œä¼˜åŒ–çš„å·¥å…·åº“ï¼Œå¯ä»¥æœ¬åœ°ç¼“å­˜å‡½æ•°çš„ç»“æœï¼Œä»è€Œé¿å…é‡å¤è®¡ç®—

```python
# åœ¨å®šä¹‰å‡½æ•°çš„æ–‡ä»¶é‡Œ
from joblib import Memory
location = './cache'    #  å¦‚æœè¦ç¼“å­˜äºå†…å­˜åˆ™ /dev/shm
memory = Memory(location, verbose=0)

# ç›´æ¥åŒ…è£…
process_func = memory.cache(process_func)

# è£…é¥°å™¨
@memory.cache
def process_func
```

æ³¨æ„ï¼š
- `memory.cache` æœ€å¥½åªåŒ…è£…ä¸€ä¸ªå‡½æ•°ï¼Œçº§è”åŒ…è£…å¤šä¸ªä¼šæ˜¾è‘—é™ä½é€Ÿåº¦ï¼Œå¯èƒ½æ˜¯æŸäº›ç­–ç•¥æˆ–å†…å­˜é—®é¢˜å¯¼è‡´


### OpenCV
æ›´å¤šè§ [[OpenCV]]
```python
import cv2

# Read
cv2.imread('xxx.png', flags=cv2.IMREAD_UNCHANGED)  # è¯»å•é€šé“æ—¶è¦åŠ ä¸Š flags

# Show
cv2.imshow('WINDOW_NAME', IMG)

# Video flow
key_value = (cv2.waitKey(1) & 0xFF)
if key_value == ord('q'):
	break
    
# Image flow
cv2.waitKey(0)

# Release
cv2.destroyAllWindows()

# Display Text
cv2.putText(disp_img, str, (30, 30), cv2.FONT_HERSHEY_COMPLEX_SMALL, 0.8, (255, 0, 0))
```

### PIL
è¯»å– jpg å›¾åƒé€Ÿåº¦æ¯” OpenCV ç¨æ…¢ï¼Œä½†æ˜¯å¦‚æœåªè¯»å›¾ç‰‡é«˜å®½ç­‰å±æ€§ä¼šå¿«éå¸¸å¤š
```python
from PIL import Image

# æ‰“å¼€å›¾åƒæ–‡ä»¶ï¼ˆè¿”å› File ç±»è€—æ—¶é—´çŸ­ï¼‰ï¼Œè¯»å›¾å¤±è´¥éœ€è¦å¤„ç†å¼‚å¸¸
imgfile = Image.open(label_path)

# è½¬æ¢ä¸º Image æˆ– numpy æ•°ç»„ï¼ˆè€—æ—¶é•¿ï¼‰
a = imgfile.convert("RGB")  

# è‹¥ imgfile æœ¬èº«ä¸º RGBï¼Œåˆ™ 
# np.array(a, dtype=np.uint8) å’Œ np.array(imgfile, dtype=np.uint8) ä¸€æ ·ï¼Œ
# ä½†å‰ä¸€ç§å¤šä½™æ“ä½œä¼šå¢åŠ æ›´å¤šè€—æ—¶

# PIL -> numpyï¼Œå¯é€šè¿‡è°ƒè‰²æ¿çš„æ¨¡å¼å¾—åˆ°åŸå§‹å›¾åƒæ•°æ®
np.array(a, dtype=np.uint8)

# numpy -> PIL
Image.fromarray(a.astype('uint8'))

# ä»æ–‡ä»¶æµè¯»å–å›¾ç‰‡
lab = open("xxx.png", 'rb').read()
image = Image.open(io.BytesIO(lab))

# ä¿å­˜
image.save("xx.png")

# æ˜¾ç¤º
image.show()
```

### mat73
ç”¨äºè¯»å– matlab æ ¼å¼ `.mat` æ•°æ®çš„åº“
```python
import mat73
data_dict = mat73.loadmat('xxx.mat')
```

### Pandas
- Seriesï¼šå¯ç”¨ python list, dict æˆ–è€… numpy array ç­‰æ•°æ®ç»“æ„æ¥åˆå§‹åŒ–
- DataFrameï¼šSeriesåˆ—è¡¨ï¼Œä¸€è¡Œä¸ºä¸€æ¡æ•°æ®ï¼ˆåŒ…å«å¤šä¸ªå±æ€§ï¼‰
    - `.dtypes`ï¼šçœ‹å„åˆ—æ•°æ®çš„ç±»å‹
    - `.memory_usage(deep=True)`ï¼šçœ‹åˆ—æ•°æ®å†…å­˜æ€»å ç”¨
    - `.info()`ï¼šåŒ…å«ä¸Šè¿°ä¸¤ç§çš„æ€»è§ˆ
    - `.infer_objects()`ï¼šå¯¹æ•°æ®ç±»å‹ä¸ç»Ÿä¸€çš„æ ·æœ¬è¿›è¡Œåˆ‡ç‰‡åå¯ä»¥é‡‡ç”¨è¯¥æ–¹æ³•ä¿®æ­£ä¸ºåˆé€‚æ•°æ®ç±»å‹
    - `.json_normalize()`ï¼šå¯¹åµŒå¥—å­—å…¸è¿›è¡Œå±•å¼€å¡«å……æˆ DataFrameï¼Œè¾ƒä¸ºå¤æ‚


å¦‚æœéœ€è¦èŠ‚çœå†…å­˜å¯ä»¥æ”¹å˜ä¸€ä¸‹åˆ—å…ƒç´ çš„ç±»å‹ï¼Œæ¯”å¦‚é‡‡ç”¨ `category` æ›¿ä»£å­—ç¬¦ä¸²ç±»å‹ï¼š
```python
# Category æ›¿ä»£å­—ç¬¦ä¸²
cat_cols = dataset.select_dtypes(include=object).columns
dataset[cat_cols] = dataset[cat_cols].fillna('none').astype('category')

# æ›´å°çš„ç²¾åº¦ç±»å‹æ›¿ä»£
dataset["id"] = pd.to_numeric(dataset["id"], downcast="unsigned")
```

ä¸€äº›å¸¸ç”¨çš„å¤„ç†ï¼š
```python
from pandas import Series
s1 = Series([1,'asd',231]) # ç±»ä¼¼ numpy object array
s2 = Series({'a':3, 'b':'asfwq', 'c':48})  # è‡ªåŠ¨å–ç´¢å¼•
s3 = Series({'a':3, 'b':'asfwq', 'c':48}, index=['id','b','c'])   # è‡ªå®šä¹‰ç´¢å¼•ï¼Œ'id' ç´¢å¼•æ²¡æœ‰å€¼ï¼Œæ•…ä¸º NAN

s1.notnull()        # åˆ¤æ–­é nan å€¼
s1.isnull()         # åˆ¤æ–­ nan å€¼


# ä» csv ä¸­åˆ›å»º
data = pd.read_csv(file_path) 

# ä» python æˆ– numpy æ•°ç»„åˆ›å»ºï¼Œcolumns æè¿°å±æ€§ä¿¡æ¯
data = pd.DataFrame(array, columns=['name', 'score'])

# ä» Series ä¸­åˆ›å»º
data = pd.DataFrame([s1,s2,s3])

data.iloc[0]        # æ•´æ•°ä¸‹æ ‡ç´¢å¼•

data.describe()     # å¾—åˆ°åŸºæœ¬æè¿°ï¼Œç¬¬ä¸€è¡Œ count ä¸ºéç¼ºçœå€¼ä¸ªæ•°
                    # 25% (50%, 75%åŒ): 
                    # å¤§äºæ‰€æœ‰æ•°æ®çš„25%çš„æ•°ï¼Œå°äº75%çš„æ•° çš„æ•°å€¼
                  
data.head()         # å–å¤´å‡ ä¸ªæ•°æ®
data.xxx==5         # å–å‡ºå±æ€§ xxx å€¼ä¸º 5 çš„æ‰€æœ‰æ•°æ®
data['xxx']==5      # åŒä¸Š
data[data['xxx'].isin(xxx_list)]   # é€šè¿‡å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­æ¥ç­›é€‰

data.sort_values(by=['xxx','yyy'])         # æ ¹æ® xxx å’Œ yyy çš„å€¼æ’åºï¼Œæœ‰å…ˆå
    
data[(data['xxx']-data['yyy']).abs() < 2]   # å¯ä»¥åšä¸€äº›åŸºæœ¬è¿ç®—

## å¢åŠ ä¸€ç»´ size ç”¨äºç»Ÿè®¡å»é™¤é‡å¤çš„è¡Œ
data.groupby(data.columns.tolist(),as_index=False).size()

## concat MxJ å’Œ MxKï¼Œå¾—åˆ° Mx(J+K)
pd.concat([df1, df2], axis=1)

## æŒ‰ç»™å®šçš„åˆ—è¡¨æ’åº https://www.cnblogs.com/lemonbit/p/7004505.html
data['xxx'] = all_ratings['xxx'].astype('category')
data['xxx'].cat.reorder_categories(sort_name, inplace=True)  # ä¼¼ä¹ deprecated äº†
data.sort_values('xxx', inplace=True)

## åˆ—æ’åº
data = data.reindex(sorted(data.columns), axis=1)

## åˆ‡ç‰‡
data[12:33]                           # row index ä¼šä» 12 å¼€å§‹
data[12:33].reset_index(drop=True)    # row index ä¼šä» 0 å¼€å§‹

## è½¬æ¢
data['params'].apply(pd.Series)       # é€ä¸ªå¤„ç† params åˆ—ï¼Œè½¬ä¸ºæ–°çš„ DataFrame
```

å¤„ç† excel è¡¨æ ¼ï¼Œé¦–å…ˆè¦å®‰è£… `openpyxl`ï¼Œç„¶å `xxx = pd.read_excel('xxx.xlsx')`

é—®é¢˜ï¼š
1. `ArrowInvalid: ("Could not convert '2.71' with type str: tried to convert to int64", 'Conversion failed for column params with type object')`ï¼š `to_feather()` æ—¶å‡ºç°çš„é”™è¯¯ï¼ŒåŸå› æ˜¯æ•°æ®é‡Œæœ‰ list å…ƒç´ ç±»å‹ä¸ç»Ÿä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´æ··åˆæ•°æ®çš„ object æ˜¯ä¸å…è®¸çš„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»æ˜¯åŒç±»å‹ã€‚è¿·æƒ‘è®¾è®¡ï¼Œæˆ‘éƒ½ç”¨ object äº†ï¼Œè¿˜ä¼šåœ¨æ„è¿™ä¸ªï¼Ÿ https://github.com/wesm/feather/issues/349 https://github.com/pandas-dev/pandas/issues/21228 ^3f4b47
    - é‡‡ç”¨ `.astype({'b': str})` å°†æ··åˆç±»å‹çš„ `b` åˆ—æ”¹ä¸º `str` ç±»å‹ä¼¼ä¹å¯ä»¥è§£å†³ï¼Ÿ 

### sklearn
å¸¸ç”¨çš„æœºå™¨å­¦ä¹ åº“
```python
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler, PolynomialFeatures

# ç‰¹å¾æ¯ä¸ªç»´åº¦ç¼©æ”¾åˆ° 0 å‡å€¼ 1 æ–¹å·®ï¼Œé¢„å¤„ç†åŸºæœ¬ç”¨æ³• fit_transform
scaler = StandardScaler()
norm_x = scaler.fit_transform(x)
norm_x = (x - scaler.mean_) / scaler.scale_  # ä½¿ç”¨å‚æ•°å½’ä¸€åŒ–
x = norm_x * scaler.scale_ + scaler.mean_    # ä½¿ç”¨å‚æ•°å¤åŸ

# å¤šé¡¹å¼ç‰¹å¾ç”Ÿæˆï¼Œ[1, a, b, c, a^2, ab, ac, b^2, bc, c^2]
PolynomialFeatures()

# å¯ä»¥åˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ª pipeline
pipe = Pipeline([('poly', PolynomialFeatures()), ('scaler', StandardScaler())])
pipe.fit_transform(x)
```


### absl
Google çš„åº“ï¼Œä» C++ ç§»åˆ° Pythonï¼ŒåŒ…å«æ ‡å¿—ç³»ç»Ÿã€æ—¥å¿—ç³»ç»Ÿç­‰

### Gradio
ä¸“ä¾›æœºå™¨å­¦ä¹ çš„ UI åº“ï¼Œå«æœ‰ä¸€äº›åŸºæœ¬çš„ç»„ä»¶
```python
import gradio as gr

def classify_image(image):
    input_image, input_data = preprocess(image)
    input_name = session.get_inputs()[0].name
    output_name = session.get_outputs()[0].name
    score = session.run([output_name], {input_name: input_data})[0]
    return input_image, f"è¯„åˆ†(1-5): {str(score[0].squeeze())}"

def run():
    imageBox = gr.inputs.Image().style(width=750, height=768)
    textBox = gr.outputs.Textbox()
    outputBox = gr.outputs.Image(type='numpy').style(width=224, height=224)

    gr.Interface(
        classify_image,
        imageBox,
        # set server name to local machine IP to share with another 
        [outputBox, textBox]).launch(server_name='x.x.x.x', server_port=7860)

```


## å‘
1. `cv2.error: /home/sad/opencv/modules/imgproc/src/imgwarp.cpp:3361: error: (-215) func != 0 in function resize`
   debug äº†ä¸€ä¸‹ä¼¼ä¹æ˜¯ OpenCV ä¸æ”¯æŒ 32 ä½åŠä»¥ä¸Šçš„ int æˆ– uint å‹çŸ©é˜µçš„ resize, ç„¶åç¿»äº†ä¸‹æºç , æœç„¶çº¿æ€§æ’å€¼çš„ ResizeFunc tabel ä¸æ”¯æŒ. è€Œ python caffe è¿”å›çš„å€¼æ˜¯ int64 çš„, æ‰€ä»¥æ‹¿åˆ°äº†ç©ºçš„ func, æŠ¥é”™
2. Python æ•°æ®ç»“æ„çš„ `=` èµ‹å€¼å…¨ä¸ºæŒ‡é’ˆèµ‹å€¼ ( å³æµ…æ‹·è´ ), å…±äº«å†…å­˜, å¯¹å…¶ä¿®æ”¹ä¼šå½±å“åŸæ•°æ®ç»“æ„æ•°å€¼
3. `TypeError: ellipse() takes at most 5 arguments (8 given)`ï¼šcenter å’Œ axes è¦æ˜¯æ•´æ•°
4. `Could not build wheels for bottleneck which use PEP 517 `ï¼šè£…è¿™ä¸ª `https://github.com/pybind/pybind11`
5. `fatal error: Python.h: No such file or directory`ï¼šå®‰è£…ç›¸åº”ç‰ˆæœ¬çš„å¼€å‘åŒ… `sudo apt-get install pythonxx-dev`
6. `ImportError: No module named pkg_resources`ï¼Œå¯èƒ½æ˜¯ setuptools çš„é—®é¢˜ï¼Œpip install ä¸€ä¸‹å¯èƒ½ä¼šå¥½
7. `shutil.copy(src, dst)` å¯èƒ½ä¼šå‡ºç° `dst` ä¸å­˜åœ¨çš„å¥‡æ€ªé”™è¯¯ï¼Œè‹¥ `src` æ–‡ä»¶å’Œ `dst` ç›®å½•éƒ½å­˜åœ¨åˆ™å¯èƒ½æ˜¯ç›¸å¯¹åœ°å€é—®é¢˜ï¼ŒæŠŠåœ°å€æ”¹æˆ `os.path.abspath()` çš„å°±è¡Œ
8. `OSError: [Errno 5] Input/output error`ï¼šå¹¿å·è…¾è®¯äº‘æœåŠ¡å™¨è¯»å†™ `cpfs` äº‘ç›˜å‡ºç°çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶ copy åˆ°åŒç›®å½•å¶å°”ä¼šæœ‰é—®é¢˜ï¼Œcopy åˆ°å­ç›®å½•æˆ–è®¸ä¼šå¥½ç‚¹ï¼Ÿhttps://research.google.com/colaboratory/faq.html#drive-timeout 
9. `TypeError: a bytes-like object is required, not 'str'`ï¼š è¯»å– pickle æ—¶å‡ºé”™ï¼Œéœ€è¦è¯»å…¥ byte æ ¼å¼ `open(xxx, 'rb')`
    - å¦‚æœè¿›ä¸€æ­¥å‡ºç° `UnicodeDecodeError: 'ascii' codec can't decode byte 0xad in position 0: ordinal not in range(128)` åˆ™éœ€è¦ä¿®æ”¹ encode æ ¼å¼ `pickle.load(f, encoding='latin1')`
10. `pip list` å‘ç°å®‰è£…çš„åº“ä¸åœ¨ï¼šå¯èƒ½æ˜¯å®‰è£…çš„åº“è·¯å¾„æœ‰è¯¯ï¼Œè¯¦è§ [[#åº“å®‰è£…]]
11. `pip install` å‡ºç° `No space left`  è¯´æ˜é»˜è®¤çš„ä¸´æ—¶ç¼“å­˜ç©ºé—´ä¸è¶³ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ `export TMPDIR='/work/tmp_other'` æ¥æ”¹å˜ä¸´æ—¶ç¼“å­˜ç›®å½•
12. `pip install` å‡ºç° `ERROR: Can not execute setup.py since setuptools is not available in the build environment.` é”™è¯¯ï¼šéœ€è¦æ›´æ–° pip å’Œ setuptools
13. `ModuleNotFoundError: No module named "xxx"`ï¼šå¯èƒ½æ˜¯å› ä¸ºå½“å‰ç›®å½•ä¸‹æœ‰ä¸ª xxx åº“ï¼Œæ‰€ä»¥ import äº†é”™è¯¯çš„åº“å¯¼è‡´
14. `jupyter-notebook` ç¯å¢ƒå˜é‡ä¸åŒæ­¥ï¼šé€šè¿‡ `jupyter kernelspec list` æ‰¾åˆ° kernel é…ç½®ç›®å½•ï¼ˆ`/usr/local/share/jupyter/kernels/python3/kernel.json`ï¼‰ï¼Œä¿®æ”¹ `kernel.json`ï¼Œæ·»åŠ ä¸€è¡Œ `"env": {"LD_LIBRARY_PATH":""}` æ¥è®¾ç½®ç¯å¢ƒå˜é‡
15. `ModuleNotFoundError: No module named '_ctypes'`ï¼šç»å…¸é”™è¯¯ï¼ŒåŸå› æœªæ˜ã€‚å¦‚æœè£… `libffi-dev` æ— æ³•è§£å†³åˆ™éœ€è¦é‡è£… python
16. `super(type, obj): obj must be an instance or subtype of type`ï¼šJupyter Notebook é‡è½½æ¨¡å—çš„ç¥å¥‡é”™è¯¯ï¼Œé‡å¯ kernel å°±è¡Œ
17. `Error: Failed to find a python interpreter in the .data section`ï¼š`py-spy` é—®é¢˜ï¼Œä¼¼ä¹ `py-spy record -o pro.svg -- python xxx.py` å°±æ²¡é—®é¢˜ï¼ŒåŸå› ä¸æ˜
18. pip å®‰è£…ç”¨äº†å¾ˆé•¿æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡åŠ  --verbose æ¥çœ‹çœ‹åœ¨åšä»€ä¹ˆ `pip install xxx --verbose`
19. `RET_CHECK failure (tensorflow/compiler/xla/service/gpu/gpu_compiler.cc:618) dnn != nullptr`ï¼šcuDNN ç‰ˆæœ¬é”™è¯¯ï¼Œåˆ æ‰æ—§çš„ `dpkg -P` ä»¥åŠå¯èƒ½çš„ `pip uninstall nvidia-cudnn-cu11`ï¼Œè¦çœ‹ cudnn ç”¨çš„ä»€ä¹ˆæ–¹å¼å®‰è£…
20. `wandb: ERROR api_key not configured (no-tty). call wandb.login(key=[your_api_key])`ï¼Œwandb åº“æ˜¯è”ç½‘çš„ dashboardï¼Œå‘½ä»¤è¡Œè¾“å…¥ `wandb offline` åˆ‡æ¢æˆæœ¬åœ°ç‰ˆæœ¬å…å» api_key
21. `ERROR: Could not find a version that satisfies the requirement tb-nightly`ï¼špip åº“å®‰è£…é—®é¢˜ï¼Œå¯èƒ½æ˜¯é•œåƒæºæ²¡æœ‰è¯¥åº“ï¼Œæ›´æ¢é•œåƒæºæˆ–ä½¿ç”¨å®˜æ–¹æº
22. `gradio` 502 bad gateway é”™è¯¯ï¼šæœ¬åœ°éƒ¨ç½²éœ€è¦è®¾ç½®ä¸º `0.0.0.0` æˆ–è®¾ç½®åŸŸåæ¥ç›‘å¬ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸æ˜¯ `127.0.0.1` æœ¬åœ°è¿˜å›
23. notebook æåº¦å¡é¡¿ï¼Œpy-spy æ˜¾ç¤ºå¡åœ¨ autoreload çš„ `update_instances` ä¸­ï¼š
